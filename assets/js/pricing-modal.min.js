!function(t,i){t(i).on("click.imagify",".imagify-tab",function(i){var e=t(this),a="imagify-current";i.preventDefault(),e.hasClass("imagify-current")||(i=e.find("a").attr("href")||"#"+e.find("a").attr("aria-controls"),e.closest(".imagify-tabs").next(".imagify-tabs-contents").find(".imagify-tab-content").hide().attr("aria-hidden","true"),t(i).fadeIn(275).attr("aria-hidden","false"),e.closest(".imagify-tabs").find(".imagify-tab").removeClass(a).attr("aria-selected","false"),e.addClass(a).attr("aria-selected","true"))})}(jQuery,document,window),function(k,i,_){var C={};k("#imagify-pricing-modal").length&&((C={$modal:k("#imagify-pricing-modal"),$checkboxes:k(".imagify-offer-line .imagify-checkbox"),$radios:k(".imagify-payment-modal .imagify-radio-line input"),$preView:k("#imagify-pre-checkout-view"),$plansView:k("#imagify-plans-selection-view").hide(),$paymentView:k("#imagify-payment-process-view").hide(),$successView:k("#imagify-success-view").hide(),$anotherBtn:k(".imagify-choose-another-plan"),speedFadeIn:300,getHtmlPrice:function(i,e){var a,t;return e=e||null,"object"!=typeof i?((i=(i+="").split("."))[1]=1===i[1].length?i[1]+"0":(""+i[1]).substring(0,2),t='<span class="imagify-price-big">'+i[0]+"</span> ",t+='<span class="imagify-price-mini">.'+i[1]+"</span>"):(a=i.monthly+"",i=i.yearly+"",a="0"===a?["0","00"]:a.split("."),i="0"===i?["0","00"]:i.split("."),t='<span class="imagify-switch-my">',t+='<span aria-hidden="'+("monthly"===e?"false":"true")+'" class="imagify-monthly">',t+='<span class="imagify-price-big">'+a[0]+"</span> ",t+='<span class="imagify-price-mini">.'+(1===a[1].length?a[1]+"0":(""+a[1]).substring(0,2))+"</span>",t+="</span> ",t+='<span aria-hidden="'+("yearly"===e?"false":"true")+'" class="imagify-yearly">',t+='<span class="imagify-price-big">'+i[0]+"</span> ",t+='<span class="imagify-price-mini">.'+(1===i[1].length?i[1]+"0":(""+i[1]).substring(0,2))+"</span>",t+="</span>",t+="</span>")},getHtmlDiscountPrice:function(i,e){var a="";return e=e||null,"object"==typeof i?(a+='<span class="imagify-price-discount">',a+='<span class="imagify-price-discount-dollar">$</span>',a+='<span class="imagify-switch-my">',a+='<span aria-hidden="'+("monthly"===e?"false":"true")+'" class="imagify-monthly">',a+='<span class="imagify-price-discount-number">'+(i.monthly+"")+"</span>",a+="</span>",a+='<span aria-hidden="'+("yearly"===e?"false":"true")+'" class="imagify-yearly">',a+='<span class="imagify-price-discount-number">'+(i.yearly+"")+"</span>",a+="</span>",a+="</span>"):(a+='<span class="imagify-price-discount">',a+='<span class="imagify-price-discount-dollar">$</span>',a+='<span class="imagify-price-discount-number">'+(i+="")+"</span>"),a+="</span>"},populateOffer:function(i,e,a,t){var o=_.imagify_discount_datas,n=e.additional_gb,l=e.annual_cost,s=e.id,f=e.label,c=e.monthly_cost,m=e.quota,r=e.cost,d=-1===m?"Unlimited":1e3<=m?m/1e3+" GB":m+" MB",y="monthly"===a?{monthly:c,yearly:Math.round(l/12*100)/100}:r,g=y,p=[],p=C.getPromoAppliesTo(o);return o.is_active&&"percentage"===o.coupon_type&&"monthly"===a&&(p.includes(f)||"all"===p[0])&&(e=(100-o.coupon_value)/100,y="monthly"===a?{monthly:c*e,yearly:Math.round(l*e/12*100)/100}:r*e),void 0!==t&&i.addClass("imagify-"+a+"-"+f+t),i.find(".imagify-offer-size").text(d),i.find(".imagify-number-block").html(C.getHtmlPrice(y,"monthly")),i.find(".imagify-price-block").prev(".imagify-price-discount").remove(),o.is_active&&"percentage"===o.coupon_type&&"monthly"===a&&(p.includes(f)||"all"===p[0])&&i.find(".imagify-price-block").before(C.getHtmlDiscountPrice(g,"monthly")),i.find(".imagify-approx-nb").text(5*m),"monthly"===a&&i.find(".imagify-price-add-data").text("$"+n),g=i.find(".imagify-payment-btn-select-plan").length?i.find(".imagify-payment-btn-select-plan"):i,y="monthly"===a?'{"'+f+'":{"id":'+s+',"name":"'+d+'","label":"'+f+'","data":'+m+',"dataf":"'+d+'","imgs":'+5*m+',"prices":{"monthly":'+y.monthly+',"yearly":'+y.yearly+',"add":'+n+"}}}":'{"ot'+f+'":{"id":'+s+',"name":"'+d+'","label":"'+f+'","data":'+m+',"dataf":"'+d+'","imgs":'+5*m+',"price":'+y+"}}",g.attr("data-offer",y),i},populatePayBtn:function(){var i,e,a=k(".imagify-offer-monthly"),t=k(".imagify-offer-onetime"),o=0,n=0;a.length&&(i=JSON.parse(a.attr("data-offer")),a.hasClass("imagify-offer-selected")&&(o=k("#imagify-subscription-monthly").filter(":checked").length?i[Object.keys(i)[0]].prices.monthly:12*i[Object.keys(i)[0]].prices.yearly)),t.length&&(i=JSON.parse(t.attr("data-offer")),t.hasClass("imagify-offer-selected")&&(n=i[Object.keys(i)[0]].price)),"0.00"===(e=parseFloat(n+o).toFixed(2))||0===e?k("#imagify-modal-checkout-btn").attr("disabled","disabled").addClass("imagify-button-disabled"):k("#imagify-modal-checkout-btn").removeAttr("disabled").removeClass("imagify-button-disabled")},checkCoupon:function(){var i,a=k("#imagify-coupon-code").val(),t=k(".imagify-coupon-text"),o=t.find("label"),n=k(".imagify-coupon-section");if(""===a)return n.removeClass("validated").removeClass("invalid"),void o.html(imagifyPricingModal.labels.defaultCouponLabel);i=k("#imagify-get-pricing-modal").data("nonce"),t.addClass("checking"),k.post(ajaxurl,{action:"imagify_check_coupon",coupon:a,imagifynonce:i},function(i){var e;t.removeClass("checking"),i.success?i.data.success?(e="percentage"===i.data.coupon_type?i.data.value+"%":"$"+i.data.value,n.removeClass("invalid").addClass("validated"),o.html(imagifyPricingModal.labels.successCouponAPI),o.find(".imagify-coupon-offer").text(e),o.find(".imagify-coupon-word").text(a)):(n.removeClass("validated").addClass("invalid"),o.text(i.data.detail)):(n.removeClass("validated").addClass("invalid"),o.text(imagifyPricingModal.labels.errorCouponAPI))})},getPricing:function(i){var e=i.data("nonce"),i={action:"imagify_get_prices",imagifynonce:e},a={action:"imagify_get_images_counts",imagifynonce:e},t={action:"imagify_get_discount",imagifynonce:e};C.$modal.find(".imagify-modal-loader").hide().show(),C.$modal.addClass("imagify-modal-loading"),k.post(ajaxurl,i,function(b){b.success&&k.post(ajaxurl,a,function(v){v.success&&k.post(ajaxurl,t,function(i){var e,a,t,o,n,l,s,f,c,m=25,r="",d="";if(i.success){if(f=v.data,e=b.data,a=i.data,t={mo:[],ot:[]},u={month:f.average_month_size.raw/Math.pow(1024,2),total:f.total_library_size.raw/Math.pow(1024,2)},o=k("#imagify-offer-monthly-template"),n=k("#imagify-offer-onetime-template"),l=n.html(),s=o.html(),i=k(".imagify-estimation-block"),k.each(e.monthlies,function(i,e){(void 0===e.active||void 0!==e.active&&!0===e.active)&&("free"===e.label&&(m=e.quota),t.mo.push(e))}),k.each(e.onetimes,function(i,e){(void 0===e.active||void 0!==e.active&&!0===e.active)&&t.ot.push(e)}),i.removeClass("imagify-analyzing"),i.find(".average-month-size").text(f.average_month_size.human),i.find(".total-library-size").text(f.total_library_size.human),u.total+u.month<m?k(".imagify-pre-checkout-offers .imagify-modal-title").addClass("imagify-enough-free"):k(".imagify-enough-free").removeClass("imagify-enough-free"),k(".imagify-offer-selected").removeClass("imagify-offer-selected").find(".imagify-checkbox").prop("checked",!1),null===t.mo||null===t.ot)return(c=k(".imagify-pre-checkout-offers")).hide().attr("aria-hidden",!0),c.closest(".imagify-modal-views").find(".imagify-popin-message").remove(),c.after('<div class="imagify-popin-message imagify-error"><p>'+imagifyPricingModal.labels.errorPriceAPI+"</p></div>"),C.$modal.find(".imagify-modal-loader").fadeOut(300),void C.$modal.removeClass("imagify-modal-loading");if((_.imagify_discount_datas=a).is_active){if(a.applies_to instanceof Array){for(var y=[],g=[],p=0;p<a.applies_to.length;p++)g.push(a.applies_to[p].plan_name);g.forEach(function(i){y.includes(i)||y.push(i)}),y=y.join(", ")}else y=a.applies_to;i=k(".imagify-modal-promotion"),f=a.date_end.split("T")[0],c=a.coupon_value,c="percentage"===a.coupon_type?c+"%":"$"+c,i.addClass("active").attr("aria-hidden","false"),i.find(".imagify-promotion-number").text(c),i.find(".imagify-promotion-plan-name").text(y),i.find(".imagify-promotion-date").text(f)}var u,h=C.getSuggestedOffers(t,u,m);0===t.mo.length?(k(".imagify-pre-checkout-offers .imagify-offer-monthly").remove(),k(".imagify-tabs").remove(),k(".imagify-pricing-tab-monthly").remove()):k.each(t.mo,function(i,e){var a,t="";if(2<i-h.mo.index)return!0;i===h.mo.index&&(a=k(".imagify-pre-checkout-offers .imagify-offer-monthly"),h.mo.selected&&(t=" imagify-offer-selected",a.addClass("imagify-offer-selected").find(".imagify-checkbox").prop("checked",!0)),C.populateOffer(a,e,"monthly")),a=k(s).clone(),a=C.populateOffer(a,e,"monthly",t),d+=a[0].outerHTML}),0===t.ot.length?(k(".imagify-pre-checkout-offers .imagify-offer-onetime").remove(),k(".imagify-tabs").remove(),k(".imagify-pricing-tab-onetime").remove()):k.each(t.ot,function(i,e){var a,t="";i===h.ot.index&&(a=k(".imagify-pre-checkout-offers .imagify-offer-onetime"),h.ot.selected&&(t=" imagify-offer-selected",a.addClass("imagify-offer-selected").find(".imagify-checkbox").prop("checked",!0)),C.populateOffer(a,e,"onetime")),a=k(l).clone(),a=C.populateOffer(a,e,"onetime",t),r+=a[0].outerHTML}),a&&(((u=C.getPromoAppliesTo(a)).includes(h.mo.plan_label)||u.includes(h.ot.plan_label))&&k("#imagify-coupon-code").val(a.label),a.is_active&&C.checkCoupon()),o.parent().find(".imagify-offer-line")&&o.parent().find(".imagify-offer-line").remove(),o.before(d),n.parent().find(".imagify-offer-line")&&n.parent().find(".imagify-offer-line").remove(),n.before(r),C.$modal.find(".imagify-modal-loader").fadeOut(300),C.$modal.removeClass("imagify-modal-loading")}})}),C.populatePayBtn()})},getSuggestedOffers:function(i,a,t){var o,n,e,l,s,f,c=a.total+a.month,m={quota:0},r={mo:!1,ot:!1};return i.ot.length<0&&(e=i.ot[i.ot.length-1].id,l=i.ot[i.ot.length-1].label),i.ot.length<0&&(s=i.mo[i.mo.length-1].id,f=i.mo[i.mo.length-1].label),k.each(i.mo,function(i,e){return e.quota<0&&(n={index:i,selected:1,plan_id:e.id,plan_label:e.label}),e.quota>m.quota&&(m={index:i,selected:1,quota:e.quota,plan_id:e.id,plan_label:e.label}),0===e.monthly_cost&&0===e.annual_cost||e.quota<=0&&a.month>e.quota||a.total>e.quota||0<=e.quota&&a.month<e.quota&&a.total<e.quota&&(void 0===o||o.quota>e.quota)&&(o=e,r.mo={index:i,selected:t>a.month&&t>a.total?0:1,plan_id:e.id,plan_label:e.label}),!0}),!1===r.mo&&(r.mo=void 0!==n?n:m),c-=i.mo[r.mo.index].quota,0===i.ot.length?r:c<=0?(k.each(i.ot,function(i,e){return e.quota<a.total||!(r.ot={index:i,selected:0,plan_id:e.id,plan_label:e.label})}),!1===r.ot&&(r.ot={index:i.ot.length-1,selected:0,plan_id:e,plan_label:l}),r):(k.each(i.ot,function(i,e){return e.quota<c||!(r.ot={index:i,selected:1,plan_id:e.id,plan_label:e.label})}),!1!==r.ot||(r.ot={index:i.ot.length-1,selected:1,plan_id:e,plan_label:l},r.mo=!1,c=a.total+a.month-i.ot[r.ot.index].quota,k.each(i.mo,function(i,e){return e.quota<c||!(r.mo={index:i,selected:1,plan_id:e.id,plan_label:e.label})}),!1===r.mo&&(r.mo={index:i.mo.length-1,selected:1,plan_id:s,plan_label:f})),r)},checkCheckbox:function(i){var e="imagify-offer-selected";i.each(function(){var i=k(this);i.is(":checked")?i.closest(".imagify-offer-line").addClass(e):i.closest(".imagify-offer-line").removeClass(e)}),C.populatePayBtn()},checkRadio:function(i){var t="imagify-year-selected",o="imagify-month-selected";return i.each(function(){var i=k(this),e=i.parent(".imagify-cart-list-switcher").length?i.closest(".imagify-cart"):i.parent(".imagify-small-options").length?i.parent(".imagify-small-options").next(".imagify-pricing-table"):i.closest(".imagify-offer-line"),a=e.find(".imagify-switch-my");"yearly"===i.val()?(e.addClass(t).removeClass(o),a.find(".imagify-monthly").attr("aria-hidden","true"),a.find(".imagify-yearly").attr("aria-hidden","false")):(e.addClass(o).removeClass(t),a.find(".imagify-monthly").attr("aria-hidden","false"),a.find(".imagify-yearly").attr("aria-hidden","true"))}),C.populatePayBtn(),i},populateBtnPrice:setInterval(function(){C.populatePayBtn()},1e3),getPeriod:function(){return k(".imagify-offer-monthly").hasClass("imagify-month-selected")?"monthly":"yearly"},getApiKey:function(){return k("#imagify-payment-iframe").data("imagify-api")},switchToView:function(i,e){var a=i.attr("id"),t=C.$modal.children(".imagify-modal-content");i.siblings(".imagify-modal-views").hide().attr("aria-hidden","true"),e&&e.tab&&i.find('a[href="#'+e.tab+'"]').trigger("click.imagify"),"imagify-payment-process-view"===a?t.addClass("imagify-iframe-viewing"):t.removeClass("imagify-iframe-viewing"),"imagify-success-view"===a?(t.addClass("imagify-success-viewing"),C.$modal.attr("aria-labelledby","imagify-success-view")):(t.removeClass("imagify-success-viewing"),C.$modal.removeAttr("aria-labelledby")),i.fadeIn(C.speedFadeIn).attr("aria-hidden","false")},iframeSetSrc:function(i){var e=k("#imagify-payment-iframe"),a=e.attr("src"),t=e.data("src"),o=0,n=0;if("string"==typeof i&&""!==a)return a=a.replace("monthly"===i?"yearly":"monthly",i),void e.attr("src",a);"object"==typeof i&&(i.monthly&&(o=i.monthly[Object.keys(i.monthly)[0]].id),i.onetime&&(n=(n=i.onetime[Object.keys(i.onetime)[0]].id)+""=="999"?i.onetime[Object.keys(i.onetime)[0]].data:n),i.period?(C.getApiKey(),a=n,n="yearly"===i.period?o:0,i="monthly"===i.period?o:0,o=""===(o=k("#imagify-coupon-code").val())?"none":o,parseFloat(k(".imagify-global-amount").text()).toFixed(2),t=t+a+"/"+i+"/"+n+"/"+o+"/",t=e.remove().attr("src",t),C.$paymentView.html(t)):_.imagify.info("No period defined"))},paymentClose:function(){k(".imagify-iframe-viewing .close-btn").trigger("click.imagify"),k(".imagify-iframe-viewing").removeClass("imagify-iframe-viewing")},paymentBack:function(){C.switchToView(C.$preView)},paymentSuccess:function(){C.switchToView(C.$successView)},checkPluginMessage:function(i){var e=i.origin||i.originalEvent.origin;if("https://app.imagify.io"===e||"http://dapp.imagify.io"===e)switch(i.data){case"cancel":C.paymentClose();break;case"back":C.paymentBack();break;case"success":C.paymentSuccess()}},getPromoAppliesTo:function(i){var e=[];if(i.applies_to instanceof Array){for(var a=[],t=0;t<i.applies_to.length;t++)a.push(i.applies_to[t].plan_name);a.forEach(function(i){e.includes(i)||e.push(i)})}else e=[i.applies_to];return e}}).checkCheckbox(C.$checkboxes),C.checkRadio(C.$radios.filter(":checked")),C.checkCoupon(),C.$checkboxes.on("change.imagify",function(){C.checkCheckbox(k(this))}),C.$radios.on("change.imagify",function(){C.checkRadio(k(this))}),k("#imagify-get-pricing-modal").on("click.imagify-ajax",function(){C.getPricing(k(this))}),k(i).on("modalClosed.imagify",".imagify-payment-modal",function(){k("#imagify-coupon-code").val(""),k(this).find(".imagify-modal-content").removeClass("imagify-success-viewing imagify-iframe-viewing"),setTimeout(function(){k(".imagify-modal-views").hide(),k("#imagify-pre-checkout-view").show()},300),setTimeout(function(){k(".imagify-payment-modal").find(".imagify-modal-content").scrollTop(0)},400)}),k("#imagify-coupon-code").on("blur.imagify",function(){k(this).attr("readonly")||C.checkCoupon()}).on("keydown.imagify",function(i){var e=k(this);if(!e.attr("readonly"))return 13===i.keyCode||32===i.keyCode?(C.checkCoupon(),!1):void(3<=e.val().length?e.closest(".imagify-coupon-input").addClass("imagify-canbe-validate"):e.closest(".imagify-coupon-input").removeClass("imagify-canbe-validate"))}),k("#imagify-coupon-validate").on("click.imagify",function(){C.checkCoupon(),k(this).closest(".imagify-canbe-validate").removeClass("imagify-canbe-validate")}),C.$anotherBtn.on("click.imagify",function(i){var e="imagify-pricing-tab-"+("plan"===k(this).data("imagify-choose")?"monthly":"onetime");i.preventDefault(),C.switchToView(C.$plansView,{tab:e})}),C.$modal.on("click.imagify",".imagify-payment-btn-select-plan",function(i){var e=k(this),a=e.closest(".imagify-offer-line"),t=e.data("offer"),o=e.attr("data-offer"),n="imagify-pricing-tab-monthly"!==e.closest(".imagify-tab-content").attr("id"),l=n?C.$preView.find(".imagify-offer-onetime"):C.$preView.find(".imagify-offer-monthly"),s=n?null:e.closest(".imagify-pricing-table").hasClass("imagify-month-selected")?"monthly":"yearly",f=n?C.getHtmlPrice(t[Object.keys(t)[0]].price):C.getHtmlPrice(t[Object.keys(t)[0]].prices,s),c=n?"":'<span class="imagify-price-by">'+a.find(".imagify-price-by").text()+"</span>",m=a.find(".imagify-price-discount").html(),r=a.find(".imagify-approx-nb").text(),d=a.find(".imagify-offer-size").text(),e=k("#imagify-coupon-code");i.preventDefault(),C.switchToView(C.$preView),l.find(".imagify-number-block").html(f+c),m?(l.find(".imagify-price-discount").length<=0&&l.find(".imagify-col-price").prepend('<span class="imagify-price-discount"></span>'),l.find(".imagify-price-discount").html(m),l.find(".imagify-price-discount").show()):l.find(".imagify-price-discount").hide(),l.find(".imagify-approx-nb").text(r),l.find(".imagify-offer-size").text(d),l.attr("data-offer",o),n||(l.find(".imagify-price-add-data").text(a.find(".imagify-price-add-data").text()),("monthly"===s?l.find("#imagify-subscription-monthly"):l.find("#imagify-subscription-yearly")).trigger("click.imagify"),l.find(".imagify-inline-options").find("input:radio:checked").trigger("change.imagify")),(e=k("#imagify-coupon-code")).val(""),_.imagify_discount_datas&&C.getPromoAppliesTo(_.imagify_discount_datas).includes(t[Object.keys(t)[0]].label)&&e.val(_.imagify_discount_datas.label),C.checkCoupon(),C.populatePayBtn()}),k("#imagify-modal-checkout-btn").on("click.imagify",function(i){var e,a;i.preventDefault(),k(this).hasClass("imagify-button-disabled")||(e=k(".imagify-offer-monthly"),a=k(".imagify-offer-onetime"),i={},e.hasClass("imagify-offer-selected")&&(i.monthly=JSON.parse(e.attr("data-offer"))),a.hasClass("imagify-offer-selected")&&(i.onetime=JSON.parse(a.attr("data-offer"))),imagifyPricingModal.userDataCache&&k.post(ajaxurl,{action:imagifyPricingModal.userDataCache.deleteAction,_wpnonce:imagifyPricingModal.userDataCache.deleteNonce}),C.switchToView(C.$paymentView),i.period=C.getPeriod(),C.iframeSetSrc(i))}),k(".imagify-back-to-plans").on("click.imagify",function(i){var e=k(this).closest(".imagify-cart-item").hasClass("imagify-cart-item-onetime");i.preventDefault(),k(e?".imagify-offer-onetime":".imagify-offer-monthly").find(".imagify-choose-another-plan").trigger("click.imagify")}),_.addEventListener("message",C.checkPluginMessage,!0))}(jQuery,document,window);
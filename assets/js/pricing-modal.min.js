!function(t,i){t(i).on("click.imagify",".imagify-tab",function(i){var e=t(this),a="imagify-current";i.preventDefault(),e.hasClass("imagify-current")||(i=e.find("a").attr("href")||"#"+e.find("a").attr("aria-controls"),e.closest(".imagify-tabs").next(".imagify-tabs-contents").find(".imagify-tab-content").hide().attr("aria-hidden","true"),t(i).fadeIn(275).attr("aria-hidden","false"),e.closest(".imagify-tabs").find(".imagify-tab").removeClass(a).attr("aria-selected","false"),e.addClass(a).attr("aria-selected","true"))})}(jQuery,document,window),function(k,i,C){var w={};k("#imagify-pricing-modal").length&&((w={$modal:k("#imagify-pricing-modal"),$checkboxes:k(".imagify-offer-line .imagify-checkbox"),$radios:k(".imagify-payment-modal .imagify-radio-line input"),$preView:k("#imagify-pre-checkout-view"),$plansView:k("#imagify-plans-selection-view").hide(),$paymentView:k("#imagify-payment-process-view").hide(),$successView:k("#imagify-success-view").hide(),$anotherBtn:k(".imagify-choose-another-plan"),speedFadeIn:300,getHtmlPrice:function(i,e){var a,t;return e=e||null,"object"!=typeof i?((i=(i+="").split("."))[1]=1===i[1].length?i[1]+"0":(""+i[1]).substring(0,2),t='<span class="imagify-price-big">'+i[0]+"</span> ",t+='<span class="imagify-price-mini">.'+i[1]+"</span>"):(a=i.monthly+"",i=i.yearly+"",a="0"===a?["0","00"]:a.split("."),i="0"===i?["0","00"]:i.split("."),t='<span class="imagify-switch-my">',t+='<span aria-hidden="'+("monthly"===e?"false":"true")+'" class="imagify-monthly">',t+='<span class="imagify-price-big">'+a[0]+"</span> ",t+='<span class="imagify-price-mini">.'+(1===a[1].length?a[1]+"0":(""+a[1]).substring(0,2))+"</span>",t+="</span> ",t+='<span aria-hidden="'+("yearly"===e?"false":"true")+'" class="imagify-yearly">',t+='<span class="imagify-price-big">'+i[0]+"</span> ",t+='<span class="imagify-price-mini">.'+(1===i[1].length?i[1]+"0":(""+i[1]).substring(0,2))+"</span>",t+="</span>",t+="</span>")},getHtmlDiscountPrice:function(i,e){var a="";return e=e||null,"object"==typeof i?(a+='<span class="imagify-price-discount">',a+='<span class="imagify-price-discount-dollar">$</span>',a+='<span class="imagify-switch-my">',a+='<span aria-hidden="'+("monthly"===e?"false":"true")+'" class="imagify-monthly">',a+='<span class="imagify-price-discount-number">'+(i.monthly+"")+"</span>",a+="</span>",a+='<span aria-hidden="'+("yearly"===e?"false":"true")+'" class="imagify-yearly">',a+='<span class="imagify-price-discount-number">'+(i.yearly+"")+"</span>",a+="</span>",a+="</span>"):(a+='<span class="imagify-price-discount">',a+='<span class="imagify-price-discount-dollar">$</span>',a+='<span class="imagify-price-discount-number">'+(i+="")+"</span>"),a+="</span>"},populateOffer:function(i,e,a,t){var o=C.imagify_discount_datas,n=e.additional_gb,f=e.annual_cost,s=e.id,c=e.label,m=e.monthly_cost,r=e.quota,l=e.cost,y=-1===r?"Unlimited":1e3<=r?r/1e3+" GB":r+" MB",d="monthly"===a?{monthly:m,yearly:Math.round(f/12*100)/100}:l,g=d,p=[];if(o.applies_to instanceof Array){for(var u=[],h=0;h<o.applies_to.length;h++)u.push(o.applies_to[h].plan_name);u.forEach(function(i){p.includes(i)||p.push(i)})}else p=[o.applies_to];return o.is_active&&"percentage"===o.coupon_type&&"monthly"===a&&(p.includes(c)||"all"===p[0])&&(e=(100-o.coupon_value)/100,d="monthly"===a?{monthly:m*e,yearly:Math.round(f*e/12*100)/100}:l*e),void 0!==t&&i.addClass("imagify-"+a+"-"+c+t),i.find(".imagify-offer-size").text(y),i.find(".imagify-number-block").html(w.getHtmlPrice(d,"monthly")),o.is_active&&"percentage"===o.coupon_type&&"monthly"===a&&(p.includes(c)||"all"===p[0])&&(i.find(".imagify-price-block").prev(".imagify-price-discount").remove(),i.find(".imagify-price-block").before(w.getHtmlDiscountPrice(g,"monthly"))),i.find(".imagify-approx-nb").text(5*r),"monthly"===a&&i.find(".imagify-price-add-data").text("$"+n),g=i.find(".imagify-payment-btn-select-plan").length?i.find(".imagify-payment-btn-select-plan"):i,d="monthly"===a?'{"'+c+'":{"id":'+s+',"name":"'+y+'","data":'+r+',"dataf":"'+y+'","imgs":'+5*r+',"prices":{"monthly":'+d.monthly+',"yearly":'+d.yearly+',"add":'+n+"}}}":'{"ot'+c+'":{"id":'+s+',"name":"'+y+'","data":'+r+',"dataf":"'+y+'","imgs":'+5*r+',"price":'+d+"}}",g.attr("data-offer",d),i},populatePayBtn:function(){var i,e,a=k(".imagify-offer-monthly"),t=k(".imagify-offer-onetime"),o=0,n=0;a.length&&(i=JSON.parse(a.attr("data-offer")),a.hasClass("imagify-offer-selected")&&(o=k("#imagify-subscription-monthly").filter(":checked").length?i[Object.keys(i)[0]].prices.monthly:12*i[Object.keys(i)[0]].prices.yearly)),t.length&&(i=JSON.parse(t.attr("data-offer")),t.hasClass("imagify-offer-selected")&&(n=i[Object.keys(i)[0]].price)),"0.00"===(e=parseFloat(n+o).toFixed(2))||0===e?k("#imagify-modal-checkout-btn").prop("disabled",!0).addClass("imagify-button-disabled"):k("#imagify-modal-checkout-btn").prop("disabled",!1).removeClass("imagify-button-disabled")},checkCoupon:function(){var a,t,o,i,n=k("#imagify-coupon-code").val();""!==n&&(a=k(".imagify-coupon-text"),t=a.find("label"),o=k(".imagify-coupon-section"),i=k("#imagify-get-pricing-modal").data("nonce"),a.addClass("checking"),k.post(ajaxurl,{action:"imagify_check_coupon",coupon:n,imagifynonce:i},function(i){var e;a.removeClass("checking"),i.success?i.data.success?(e="percentage"===i.data.coupon_type?i.data.value+"%":"$"+i.data.value,o.removeClass("invalid").addClass("validated"),t.html(imagifyPricingModal.labels.successCouponAPI),t.find(".imagify-coupon-offer").text(e),t.find(".imagify-coupon-word").text(n)):(o.removeClass("validated").addClass("invalid"),t.text(i.data.detail)):(o.removeClass("validated").addClass("invalid"),t.text(imagifyPricingModal.labels.errorCouponAPI))}))},getPricing:function(i){var e=i.data("nonce"),i={action:"imagify_get_prices",imagifynonce:e},a={action:"imagify_get_images_counts",imagifynonce:e},t={action:"imagify_get_discount",imagifynonce:e};w.$modal.find(".imagify-modal-loader").hide().show(),k.post(ajaxurl,i,function(b){b.success&&k.post(ajaxurl,a,function(v){v.success&&k.post(ajaxurl,t,function(i){var e,a,t,o,n,f,s,c,m,r,l,y=25,d="",g="";if(i.success){if(r=v.data,e=b.data,a=i.data,t={mo:[],ot:[]},o={month:r.average_month_size.raw/Math.pow(1024,2),total:r.total_library_size.raw/Math.pow(1024,2)},f=k("#imagify-offer-monthly-template"),s=k("#imagify-offer-onetime-template"),c=s.html(),m=f.html(),i=k(".imagify-estimation-block"),k.each(e.monthlies,function(i,e){(void 0===e.active||void 0!==e.active&&!0===e.active)&&("free"===e.label&&(y=e.quota),t.mo.push(e))}),k.each(e.onetimes,function(i,e){(void 0===e.active||void 0!==e.active&&!0===e.active)&&t.ot.push(e)}),i.removeClass("imagify-analyzing"),i.find(".average-month-size").text(r.average_month_size.human),i.find(".total-library-size").text(r.total_library_size.human),o.total+o.month<y?k(".imagify-pre-checkout-offers .imagify-modal-title").addClass("imagify-enough-free"):k(".imagify-enough-free").removeClass("imagify-enough-free"),k(".imagify-offer-selected").removeClass("imagify-offer-selected").find(".imagify-checkbox").prop("checked",!1),null===t.mo||null===t.ot)return(l=k(".imagify-pre-checkout-offers")).hide().attr("aria-hidden",!0),l.closest(".imagify-modal-views").find(".imagify-popin-message").remove(),l.after('<div class="imagify-popin-message imagify-error"><p>'+imagifyPricingModal.labels.errorPriceAPI+"</p></div>"),void w.$modal.find(".imagify-modal-loader").fadeOut(300);if((C.imagify_discount_datas=a).is_active){if(a.applies_to instanceof Array){for(var p=[],u=[],h=0;h<a.applies_to.length;h++)u.push(a.applies_to[h].plan_name);u.forEach(function(i){p.includes(i)||p.push(i)}),p=p.join(", ")}else p=a.applies_to;i=k(".imagify-modal-promotion"),r=a.date_end.split("T")[0],l=a.coupon_value,l="percentage"===a.coupon_type?l+"%":"$"+l,k("#imagify-coupon-code").val(a.label).attr("readonly",!0),i.addClass("active").attr("aria-hidden","false"),i.find(".imagify-promotion-number").text(l),i.find(".imagify-promotion-plan-name").text(p),i.find(".imagify-promotion-date").text(r),w.checkCoupon()}n=w.getSuggestedOffers(t,o,y),0===t.mo.length?(k(".imagify-pre-checkout-offers .imagify-offer-monthly").remove(),k(".imagify-tabs").remove(),k(".imagify-pricing-tab-monthly").remove()):k.each(t.mo,function(i,e){var a,t="";if(2<i-n.mo.index)return!0;i===n.mo.index&&(a=k(".imagify-pre-checkout-offers .imagify-offer-monthly"),n.mo.selected&&(t=" imagify-offer-selected",a.addClass("imagify-offer-selected").find(".imagify-checkbox").prop("checked",!0)),w.populateOffer(a,e,"monthly")),a=k(m).clone(),a=w.populateOffer(a,e,"monthly",t),g+=a[0].outerHTML}),0===t.ot.length?(k(".imagify-pre-checkout-offers .imagify-offer-onetime").remove(),k(".imagify-tabs").remove(),k(".imagify-pricing-tab-onetime").remove()):k.each(t.ot,function(i,e){var a,t="";i===n.ot.index&&(a=k(".imagify-pre-checkout-offers .imagify-offer-onetime"),n.ot.selected&&(t=" imagify-offer-selected",a.addClass("imagify-offer-selected").find(".imagify-checkbox").prop("checked",!0)),w.populateOffer(a,e,"onetime")),a=k(c).clone(),a=w.populateOffer(a,e,"onetime",t),d+=a[0].outerHTML}),f.parent().find(".imagify-offer-line")&&f.parent().find(".imagify-offer-line").remove(),f.before(g),s.parent().find(".imagify-offer-line")&&s.parent().find(".imagify-offer-line").remove(),s.before(d),w.$modal.find(".imagify-modal-loader").fadeOut(300)}})}),w.populatePayBtn()})},getSuggestedOffers:function(i,a,t){var o,n,f=a.total+a.month,s={quota:0},c={mo:!1,ot:!1};return k.each(i.mo,function(i,e){return e.quota<0&&(n={index:i,selected:1}),e.quota>s.quota&&(s={index:i,selected:1,quota:e.quota}),0===e.monthly_cost&&0===e.annual_cost||e.quota<=0&&a.month>e.quota||a.total>e.quota||0<=e.quota&&a.month<e.quota&&a.total<e.quota&&(void 0===o||o.quota>e.quota)&&(o=e,c.mo={index:i,selected:t>a.month&&t>a.total?0:1}),!0}),!1===c.mo&&(c.mo=void 0!==n?n:s),f-=i.mo[c.mo.index].quota,0===i.ot.length?c:f<=0?(k.each(i.ot,function(i,e){return e.quota<a.total||!(c.ot={index:i,selected:0})}),!1===c.ot&&(c.ot={index:i.ot.length-1,selected:0}),c):(k.each(i.ot,function(i,e){return e.quota<f||!(c.ot={index:i,selected:1})}),!1!==c.ot||(c.ot={index:i.ot.length-1,selected:1},c.mo=!1,f=a.total+a.month-i.ot[c.ot.index].quota,k.each(i.mo,function(i,e){return e.quota<f||!(c.mo={index:i,selected:1})}),!1===c.mo&&(c.mo={index:i.mo.length-1,selected:1})),c)},checkCheckbox:function(i){var e="imagify-offer-selected";i.each(function(){var i=k(this);i.is(":checked")?i.closest(".imagify-offer-line").addClass(e):i.closest(".imagify-offer-line").removeClass(e)}),w.populatePayBtn()},checkRadio:function(i){var t="imagify-year-selected",o="imagify-month-selected";return i.each(function(){var i=k(this),e=i.parent(".imagify-cart-list-switcher").length?i.closest(".imagify-cart"):i.parent(".imagify-small-options").length?i.parent(".imagify-small-options").next(".imagify-pricing-table"):i.closest(".imagify-offer-line"),a=e.find(".imagify-switch-my");"yearly"===i.val()?(e.addClass(t).removeClass(o),a.find(".imagify-monthly").attr("aria-hidden","true"),a.find(".imagify-yearly").attr("aria-hidden","false")):(e.addClass(o).removeClass(t),a.find(".imagify-monthly").attr("aria-hidden","false"),a.find(".imagify-yearly").attr("aria-hidden","true"))}),w.populatePayBtn(),i},populateBtnPrice:setInterval(function(){w.populatePayBtn()},1e3),getPeriod:function(){return k(".imagify-offer-monthly").hasClass("imagify-month-selected")?"monthly":"yearly"},getApiKey:function(){return k("#imagify-payment-iframe").data("imagify-api")},switchToView:function(i,e){var a=i.attr("id"),t=w.$modal.children(".imagify-modal-content");i.siblings(".imagify-modal-views").hide().attr("aria-hidden","true"),e&&e.tab&&i.find('a[href="#'+e.tab+'"]').trigger("click.imagify"),"imagify-payment-process-view"===a?t.addClass("imagify-iframe-viewing"):t.removeClass("imagify-iframe-viewing"),"imagify-success-view"===a?(t.addClass("imagify-success-viewing"),w.$modal.attr("aria-labelledby","imagify-success-view")):(t.removeClass("imagify-success-viewing"),w.$modal.removeAttr("aria-labelledby")),i.fadeIn(w.speedFadeIn).attr("aria-hidden","false")},iframeSetSrc:function(i){var e=k("#imagify-payment-iframe"),a=e.attr("src"),t=e.data("src"),o=0,n=0;if("string"==typeof i&&""!==a)return a=a.replace("monthly"===i?"yearly":"monthly",i),void e.attr("src",a);"object"==typeof i&&(i.monthly&&(o=i.monthly[Object.keys(i.monthly)[0]].id),i.onetime&&(n=(n=i.onetime[Object.keys(i.onetime)[0]].id)+""=="999"?i.onetime[Object.keys(i.onetime)[0]].data:n),i.period?(w.getApiKey(),a=n,n="yearly"===i.period?o:0,i="monthly"===i.period?o:0,o=""===(o=k("#imagify-coupon-code").val())?"none":o,parseFloat(k(".imagify-global-amount").text()).toFixed(2),t=t+a+"/"+i+"/"+n+"/"+o+"/",t=e.remove().attr("src",t),w.$paymentView.html(t)):C.imagify.info("No period defined"))},paymentClose:function(){k(".imagify-iframe-viewing .close-btn").trigger("click.imagify"),k(".imagify-iframe-viewing").removeClass("imagify-iframe-viewing")},paymentBack:function(){w.switchToView(w.$preView)},paymentSuccess:function(){w.switchToView(w.$successView)},checkPluginMessage:function(i){var e=i.origin||i.originalEvent.origin;if("https://app.imagify.io"===e||"http://dapp.imagify.io"===e)switch(i.data){case"cancel":w.paymentClose();break;case"back":w.paymentBack();break;case"success":w.paymentSuccess()}}}).checkCheckbox(w.$checkboxes),w.checkRadio(w.$radios.filter(":checked")),w.checkCoupon(),w.$checkboxes.on("change.imagify",function(){w.checkCheckbox(k(this))}),w.$radios.on("change.imagify",function(){w.checkRadio(k(this))}),k("#imagify-get-pricing-modal").on("click.imagify-ajax",function(){w.getPricing(k(this))}),k(i).on("modalClosed.imagify",".imagify-payment-modal",function(){k(this).find(".imagify-modal-content").removeClass("imagify-success-viewing imagify-iframe-viewing"),setTimeout(function(){k(".imagify-modal-views").hide(),k("#imagify-pre-checkout-view").show()},300)}),k("#imagify-coupon-code").on("blur.imagify",function(){k(this).attr("readonly")||w.checkCoupon()}).on("keydown.imagify",function(i){var e=k(this);if(!e.attr("readonly"))return 13===i.keyCode||32===i.keyCode?(w.checkCoupon(),!1):void(3<=e.val().length?e.closest(".imagify-coupon-input").addClass("imagify-canbe-validate"):e.closest(".imagify-coupon-input").removeClass("imagify-canbe-validate"))}),k("#imagify-coupon-validate").on("click.imagify",function(){w.checkCoupon(),k(this).closest(".imagify-canbe-validate").removeClass("imagify-canbe-validate")}),w.$anotherBtn.on("click.imagify",function(i){var e="imagify-pricing-tab-"+("plan"===k(this).data("imagify-choose")?"monthly":"onetime");i.preventDefault(),w.switchToView(w.$plansView,{tab:e})}),w.$modal.on("click.imagify",".imagify-payment-btn-select-plan",function(i){var e=k(this),a=e.closest(".imagify-offer-line"),t=e.data("offer"),o=e.attr("data-offer"),n="imagify-pricing-tab-monthly"!==e.closest(".imagify-tab-content").attr("id"),f=n?w.$preView.find(".imagify-offer-onetime"):w.$preView.find(".imagify-offer-monthly"),s=n?null:e.closest(".imagify-pricing-table").hasClass("imagify-month-selected")?"monthly":"yearly",c=n?w.getHtmlPrice(t[Object.keys(t)[0]].price):w.getHtmlPrice(t[Object.keys(t)[0]].prices,s),m=n?"":'<span class="imagify-price-by">'+a.find(".imagify-price-by").text()+"</span>",r=a.find(".imagify-price-discount").html(),e=a.find(".imagify-approx-nb").text(),t=a.find(".imagify-offer-size").text();i.preventDefault(),w.switchToView(w.$preView),f.find(".imagify-number-block").html(c+m),f.find(".imagify-price-discount").html(r),f.find(".imagify-approx-nb").text(e),f.find(".imagify-offer-size").text(t),f.attr("data-offer",o),n||(f.find(".imagify-price-add-data").text(a.find(".imagify-price-add-data").text()),("monthly"===s?f.find("#imagify-subscription-monthly"):f.find("#imagify-subscription-yearly")).trigger("click.imagify"),f.find(".imagify-inline-options").find("input:radio:checked").trigger("change.imagify")),w.populatePayBtn()}),k("#imagify-modal-checkout-btn").on("click.imagify",function(i){var e,a;i.preventDefault(),k(this).hasClass("imagify-button-disabled")||(e=k(".imagify-offer-monthly"),a=k(".imagify-offer-onetime"),i={},e.hasClass("imagify-offer-selected")&&(i.monthly=JSON.parse(e.attr("data-offer"))),a.hasClass("imagify-offer-selected")&&(i.onetime=JSON.parse(a.attr("data-offer"))),imagifyPricingModal.userDataCache&&k.post(ajaxurl,{action:imagifyPricingModal.userDataCache.deleteAction,_wpnonce:imagifyPricingModal.userDataCache.deleteNonce}),w.switchToView(w.$paymentView),i.period=w.getPeriod(),w.iframeSetSrc(i))}),k(".imagify-back-to-plans").on("click.imagify",function(i){var e=k(this).closest(".imagify-cart-item").hasClass("imagify-cart-item-onetime");i.preventDefault(),k(e?".imagify-offer-onetime":".imagify-offer-monthly").find(".imagify-choose-another-plan").trigger("click.imagify")}),C.addEventListener("message",w.checkPluginMessage,!0))}(jQuery,document,window);
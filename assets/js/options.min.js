window.imagify=window.imagify||{},function(a,t){var s=!1,o=!1;a("#imagify-settings #api_key").on("blur.imagify",function(){var i=a(this),e=i.val();return""!==a.trim(e)&&(a("#check_api_key").val()===e?(a("#imagify-check-api-container").html('<span class="dashicons dashicons-yes"></span> '+imagifyOptions.labels.ValidApiKeyText),!1):(!0===s?o.abort():(a("#imagify-check-api-container").remove(),i.after('<span id="imagify-check-api-container"><span class="imagify-spinner"></span>'+imagifyOptions.labels.waitApiKeyCheckText+"</span>")),s=!0,void(o=a.get(ajaxurl+t.imagify.concat+"action=imagify_check_api_key_validity&api_key="+i.val()+"&imagifycheckapikeynonce="+a("#imagifycheckapikeynonce").val()).done(function(i){i.success?(a("#imagify-check-api-container").remove(),swal({title:imagifyOptions.labels.ApiKeyCheckSuccessTitle,html:imagifyOptions.labels.ApiKeyCheckSuccessText,type:"success",padding:0,customClass:"imagify-sweet-alert"}).then(function(){location.reload()})):a("#imagify-check-api-container").html('<span class="dashicons dashicons-no"></span> '+i.data),s=!1}))))}),a(".imagify-options-line").css("cursor","pointer").on("click.imagify",function(i){"INPUT"!==i.target.nodeName&&a('input[aria-describedby="'+a(this).attr("id")+'"]').trigger("click.imagify")}),a(".imagify-settings th span").on("click.imagify",function(){var i=a(this).parent().next("td").find(":checkbox");1===i.length&&i.trigger("click.imagify")}),a(".imagify-options-line").find("input").on("change.imagify focus.imagify",function(){var i;"checkbox"===this.type&&!this.checked||!(i=a(this).closest(".imagify-options-line").prev("label").prev(":checkbox")).length||i[0].checked||i.prop("checked",!0)}),a('[name="imagify_settings[backup]"]').on("change.imagify",function(){var i=a(this),e=i.siblings("#backup-dir-is-writable"),t={action:"imagify_check_backup_dir_is_writable",_wpnonce:e.data("nonce")};i.is(":checked")?a.getJSON(ajaxurl,t).done(function(i){a.isPlainObject(i)&&i.success&&(i.data.is_writable?e.addClass("hidden"):e.removeClass("hidden"))}):swal({title:imagifyOptions.labels.noBackupTitle,html:imagifyOptions.labels.noBackupText,type:"warning",customClass:"imagify-sweet-alert",padding:0,showCancelButton:!0,cancelButtonText:imagifySwal.labels.cancelButtonText,reverseButtons:!0}).then(function(){e.addClass("hidden")},function(){i.prop("checked",!0)})}),a('[name="imagify_settings[display_webp_method]"]').on("change.imagify init.imagify",function(i){"picture"===i.target.value?a(i.target).closest(".imagify-radio-group").next(".imagify-options-line").removeClass("imagify-faded"):a(i.target).closest(".imagify-radio-group").next(".imagify-options-line").addClass("imagify-faded")}).filter(":checked").trigger("init.imagify")}(jQuery,(document,window)),function(i,s){i.imagifyUser&&s.getJSON(ajaxurl,i.imagifyUser).done(function(a){s.isPlainObject(a)&&a.success&&(a.data.id=null,a.data.plan_id=null,a.data.is=[],s.each(a.data,function(i,e){var t=".imagify-user-"+i.replace(/_/g,"-");0===i.indexOf("is_")?e&&a.data.is.push(t):"is"!==i&&s(t).text(e)}),a.data.is.push("best-plan"),s(a.data.is.join(",")).removeClass("hidden"))})}(window,(document,jQuery)),function(e,i,f){function t(t){var a,s,o,n,r=!1,l=null;t&&(o=f("#imagify-custom-folders-selected"),(n=o.find(".imagify-custom-folder-line")).find('[value="'+t+'"]').length||(t=t.split("#///#"),a=t[1].replace(/\/+$/,"").toLowerCase(),s=e.imagify.template("imagify-custom-folder"),n.each(function(){var i=f(this),e=i.data("path").replace(/\/+$/,"").toLowerCase();return""!==e&&0===a.indexOf(e)?!(r=!0):a<e?(i.before(s({value:t[0],label:t[1]})),n=o.find(".imagify-custom-folder-line"),!(r=!0)):void 0}),r||(o.append(s({value:t[0],label:t[1]})),n=o.find(".imagify-custom-folder-line")),""!==a&&n.each(function(){var i=f(this),e=i.data("path").toLowerCase();null!==l&&0===e.indexOf(l)?i.find(".imagify-custom-folders-remove").trigger("click.imagify"):l=e}),o.next(".hidden").removeClass("hidden")))}imagifyOptions.getFilesTree&&(f("#imagify-add-custom-folder").on("click.imagify",function(){var i=f(this),e=[];i.prop("disabled")||(i.prop("disabled",!0).next("img").attr("aria-hidden","false"),f("#imagify-custom-folders-selected").find("input").each(function(){e.push(this.value)}),f.post(imagifyOptions.getFilesTree,{folder:"/",selected:e},null,"json").done(function(i){i.success?swal({title:imagifyOptions.labels.filesTreeTitle,html:'<div class="imagify-swal-subtitle">'+imagifyOptions.labels.filesTreeSubTitle+'</div><div class="imagify-swal-content"><p class="imagify-folders-information"><i class="dashicons dashicons-info" aria-hidden="true"></i>'+imagifyOptions.labels.cleaningInfo+'</p><ul id="imagify-folders-tree" class="imagify-folders-tree">'+i.data+"</ul></div>",type:"",customClass:"imagify-sweet-alert imagify-swal-has-subtitle  imagify-folders-selection",showCancelButton:!0,padding:0,confirmButtonText:imagifyOptions.labels.confirmFilesTreeBtn,cancelButtonText:imagifySwal.labels.cancelButtonText,reverseButtons:!0}).then(function(){var i=f("#imagify-folders-tree input").serializeArray();i.length&&f.each(i,function(i,e){t(e.value)})}).catch(swal.noop):swal({title:imagifyOptions.labels.error,html:i.data||"",type:"error",padding:0,customClass:"imagify-sweet-alert"})}).fail(function(){swal({title:imagifyOptions.labels.error,type:"error",customClass:"imagify-sweet-alert",padding:0})}).always(function(){i.prop("disabled",!1).next("img").attr("aria-hidden","true")}))}),f(i).on("click.imagify","#imagify-folders-tree [data-folder]",function(){var e=f(this),i=e.nextAll(".imagify-folders-sub-tree"),t=[];if(!e.prop("disabled")&&!e.siblings(":checkbox").is(":checked")){if(e.prop("disabled",!0).addClass("imagify-loading"),i.length)return e.hasClass("imagify-is-open")?(i.addClass("hidden"),e.removeClass(" imagify-is-open")):(i.removeClass("hidden"),e.addClass("imagify-is-open")),void e.prop("disabled",!1).removeClass("imagify-loading");f("#imagify-custom-folders-selected").find("input").each(function(){t.push(this.value)}),f.post(imagifyOptions.getFilesTree,{folder:e.data("folder"),selected:t},null,"json").done(function(i){i.success?e.addClass("imagify-is-open").parent().append('<ul class="imagify-folders-sub-tree">'+i.data+"</ul>"):swal({title:imagifyOptions.labels.error,html:i.data||"",type:"error",padding:0,customClass:"imagify-sweet-alert"})}).fail(function(){swal({title:imagifyOptions.labels.error,type:"error",padding:0,customClass:"imagify-sweet-alert"})}).always(function(){e.prop("disabled",!1).removeClass("imagify-loading")})}}),f("#imagify-custom-folders").on("click.imagify",".imagify-custom-folders-remove",function(){var i=f(this).closest(".imagify-custom-folder-line").addClass("imagify-will-remove");e.setTimeout(function(){i.remove(),f("#imagify-custom-folders-selected").siblings(".imagify-success.hidden").removeClass("hidden")},750)}),f("#imagify-add-themes-to-custom-folder").on("click.imagify",function(){var i=f(this);t(i.data("theme")),t(i.data("theme-parent")),i.replaceWith("<p>"+imagifyOptions.labels.themesAdded+"</p>")}))}(window,document,jQuery),function(a,i,s){imagifyOptions.bulk&&(a.imagify.optionsBulk={fetchQueue:[],queue:[],processingQueue:[],fetchError:!1,error:!1,working:!1,processIsStopped:!0,processedMedia:0,totalMedia:0,$button:null,$progressWrap:null,$progressBar:null,$progressText:null,init:function(){this.$missingWebpElement=s(".generate-missing-webp"),this.$missingWebpMessage=s(".generate-missing-webp p"),this.$button=s("#imagify-generate-webp-versions"),this.$progressWrap=this.$button.siblings(".imagify-progress"),this.$progressBar=this.$progressWrap.find(".bar"),this.$progressText=this.$progressBar.find(".percent"),s("#imagify_convert_to_webp").on("change.imagify init.imagify",{imagifyOptionsBulk:this},this.toggleButton).trigger("init.imagify"),this.$button.on("click.imagify",{imagifyOptionsBulk:this},this.maybeLaunchAllProcesses),s(i).on("imagifybeat-send",{imagifyOptionsBulk:this},this.addQueueImagifybeat).on("imagifybeat-tick",{imagifyOptionsBulk:this},this.processQueueImagifybeat).on("imagifybeat-send",this.addRequirementsImagifybeat).on("imagifybeat-tick",{imagifyOptionsBulk:this},this.processRequirementsImagifybeat)},toggleButton:function(i){this.checked?i.data.imagifyOptionsBulk.$button.prop("disabled",!1):i.data.imagifyOptionsBulk.$button.prop("disabled",!0)},maybeLaunchAllProcesses:function(i){i.data.imagifyOptionsBulk&&!i.data.imagifyOptionsBulk.working&&(i.data.imagifyOptionsBulk.hasBlockingError(!0)||(i.data.imagifyOptionsBulk.fetchQueue=imagifyOptions.bulk.contexts.slice(),i.data.imagifyOptionsBulk.queue=[],i.data.imagifyOptionsBulk.processingQueue=[],i.data.imagifyOptionsBulk.fetchError=!1,i.data.imagifyOptionsBulk.error=!1,i.data.imagifyOptionsBulk.working=!0,i.data.imagifyOptionsBulk.processIsStopped=!1,i.data.imagifyOptionsBulk.processedMedia=0,i.data.imagifyOptionsBulk.totalMedia=0,i.data.imagifyOptionsBulk.$button.prop("disabled",!0).find(".dashicons").addClass("rotate"),s(a).on("beforeunload.imagify",i.data.imagifyOptionsBulk.getConfirmMessage),a.imagify.beat.interval(15),a.imagify.beat.disableSuspend(),i.data.imagifyOptionsBulk.fetchIDs()))},getConfirmMessage:function(){return imagifyOptions.bulk.labels.processing},addQueueImagifybeat:function(i,e){i.data.imagifyOptionsBulk&&i.data.imagifyOptionsBulk.processingQueue.length&&(e[imagifyOptions.bulk.imagifybeatIDs.queue]=i.data.imagifyOptionsBulk.processingQueue)},processQueueImagifybeat:function(t,i){t.data.imagifyOptionsBulk&&void 0!==i[imagifyOptions.bulk.imagifybeatIDs.queue]&&s.each(i[imagifyOptions.bulk.imagifybeatIDs.queue],function(i,e){t.data.imagifyOptionsBulk.mediaProcessed(e)})},addRequirementsImagifybeat:function(i,e){e[imagifyOptions.bulk.imagifybeatIDs.requirements]=1},processRequirementsImagifybeat:function(i,e){i.data.imagifyOptionsBulk&&void 0===e[imagifyOptions.bulk.imagifybeatIDs.requirements]||(e=e[imagifyOptions.bulk.imagifybeatIDs.requirements],imagifyOptions.bulk.curlMissing=e.curl_missing,imagifyOptions.bulk.editorMissing=e.editor_missing,imagifyOptions.bulk.extHttpBlocked=e.external_http_blocked,imagifyOptions.bulk.apiDown=e.api_down,imagifyOptions.bulk.keyIsValid=e.key_is_valid,imagifyOptions.bulk.isOverQuota=e.is_over_quota)},fetchIDs:function(){var t,a;if(!this.processIsStopped){if(!this.fetchQueue.length)return this.$missingWebpMessage.hide().attr("aria-hidden","true"),this.queue.length?(this.$progressBar.removeAttr("style"),this.$progressText.text("0"+(this.totalMedia?"/"+this.totalMedia:"")),this.$progressWrap.slideDown().attr("aria-hidden","false"),void this.processQueue()):(this.fetchError||(this.fetchError="no-images"),this.stopProcess(this.fetchError),void(this.fetchError=!1));a=(t=this).fetchQueue.shift(),s.get(this.getAjaxUrl("getMediaIds",a)).done(function(i){var e;t.processIsStopped||(e=i.data&&i.data.message?i.data.message:imagifyOptions.bulk.ajaxErrorText,i.success&&s.isArray(i.data)?i.data.length&&(t.totalMedia+=i.data.length,t.queue.push({context:a,optimizeURL:t.getAjaxUrl("bulkProcess",a),mediaIDs:i.data})):t.fetchError||(t.fetchError=e))}).fail(function(){t.fetchError||(t.fetchError="get-unoptimized-images")}).always(function(){t.fetchIDs()})}},processQueue:function(){var t=this;this.processIsStopped||(this.queue.length||this.processingQueue.length)&&s.each(this.queue,function(i,e){return!(t.processingQueue.length>=imagifyOptions.bulk.bufferSize)&&void s.each(e.mediaIDs,function(){if(t.processMedia({context:e.context,mediaID:e.mediaIDs.shift(),optimizeURL:e.optimizeURL}),e.mediaIDs.length||t.queue.shift(),t.processingQueue.length>=imagifyOptions.bulk.bufferSize)return!1})})},processMedia:function(i){var e=this,t={context:i.context,mediaID:i.mediaID};this.processingQueue.push({context:i.context,mediaID:i.mediaID}),s.post({url:i.optimizeURL,data:{media_id:i.mediaID,context:i.context},dataType:"json"}).done(function(i){i.success||e.mediaProcessed(t)}).fail(function(){e.mediaProcessed(t)})},mediaProcessed:function(t){var a=this;this.processIsStopped||(s.each(this.processingQueue,function(i,e){if(t.context===e.context&&t.mediaID===e.mediaID)return a.processingQueue.splice(i,1),!1}),++this.processedMedia,t.progress=Math.floor(this.processedMedia/this.totalMedia*100),this.$progressBar.css("width",t.progress+"%"),this.$progressText.text(this.processedMedia+"/"+this.totalMedia),this.queue.length||this.processingQueue.length?this.processQueue():this.totalMedia===this.processedMedia&&this.queueEmpty())},queueEmpty:function(){var i={};!1!==this.error&&(i="invalid-api-key"===this.error?{title:imagifyOptions.bulk.labels.invalidAPIKeyTitle,type:"info"}:"over-quota"===this.error?{title:imagifyOptions.bulk.labels.overQuotaTitle,html:s("#tmpl-imagify-overquota-alert").html(),type:"info",customClass:"imagify-swal-has-subtitle imagify-swal-error-header",showConfirmButton:!1}:"get-unoptimized-images"===this.error||"consumed-all-data"===this.error?{title:imagifyOptions.bulk.labels.getUnoptimizedImagesErrorTitle,html:imagifyOptions.bulk.labels.getUnoptimizedImagesErrorText,type:"info"}:"no-images"===this.error?{title:imagifyOptions.bulk.labels.nothingToDoTitle,html:imagifyOptions.bulk.labels.nothingToDoText,type:"info"}:"no-backup"===this.error?{title:imagifyOptions.bulk.labels.nothingToDoTitle,html:imagifyOptions.bulk.labels.nothingToDoNoBackupText,type:"info"}:{title:imagifyOptions.bulk.labels.error,html:this.error,type:"info"},this.displayError(i),this.error=!1),this.fetchQueue=[],this.queue=[],this.processingQueue=[],this.fetchError=!1,this.working=!1,this.processIsStopped=!1,this.processedMedia=0,this.totalMedia=0,a.imagify.beat.resetInterval(),a.imagify.beat.enableSuspend(),s(a).off("beforeunload.imagify",this.getConfirmMessage),this.$progressWrap.slideUp().attr("aria-hidden","true"),this.$progressBar.removeAttr("style"),this.$progressText.text("0"),this.$missingWebpElement.hide().attr("aria-hidden","true"),this.$button.find(".dashicons").removeClass("rotate")},hasBlockingError:function(i){return i=void 0!==i&&i,imagifyOptions.bulk.curlMissing?(i&&this.displayError({html:imagifyOptions.bulk.labels.curlMissing}),!0):imagifyOptions.bulk.editorMissing?(i&&this.displayError({html:imagifyOptions.bulk.labels.editorMissing}),!0):imagifyOptions.bulk.extHttpBlocked?(i&&this.displayError({html:imagifyOptions.bulk.labels.extHttpBlocked}),!0):imagifyOptions.bulk.apiDown?(i&&this.displayError({html:imagifyOptions.bulk.labels.apiDown}),!0):imagifyOptions.bulk.keyIsValid?!!imagifyOptions.bulk.isOverQuota&&(i&&this.displayError({title:imagifyOptions.bulk.labels.overQuotaTitle,html:s("#tmpl-imagify-overquota-alert").html(),type:"info",customClass:"imagify-swal-has-subtitle imagify-swal-error-header",showConfirmButton:!1}),!0):(i&&this.displayError({title:imagifyOptions.bulk.labels.invalidAPIKeyTitle,type:"info"}),!0)},displayError:function(i,e,t){var a={title:"",html:"",type:"error",customClass:"",width:620,padding:0,showCloseButton:!0,showConfirmButton:!0};(t=s.isPlainObject(i)?s.extend({},a,i):s.extend({},a,{title:i||"",html:e||""},t=t||{})).title=t.title||imagifyOptions.bulk.labels.error,t.customClass+=" imagify-sweet-alert",swal(t).catch(swal.noop)},getAjaxUrl:function(i,e){var t=ajaxurl+a.imagify.concat+"_wpnonce="+imagifyOptions.bulk.ajaxNonce;return t+="&action="+imagifyOptions.bulk.ajaxActions[i],t+="&context="+e,t+="&imagify_action=generate_webp"},stopProcess:function(i){this.processIsStopped=!0,this.error=i,this.queueEmpty()}},a.imagify.optionsBulk.init())}(window,document,jQuery),function(o){var a=o.propHooks.checked;o.propHooks.checked={set:function(i,e,t){t=void 0===a?i[t]=e:a(i,e,t);return o(i).trigger("change.imagify"),t}},o(".imagify-select-all").on("click.imagify",function(){var i=o(this),e=i.data("action"),t=i.closest(".imagify-select-all-buttons"),a=t.prev(".imagify-check-group"),s="imagify-is-inactive";if(i.hasClass(s))return!1;t.find(".imagify-select-all").removeClass(s).attr("aria-disabled","false"),i.addClass(s).attr("aria-disabled","true"),a.find(".imagify-row-check").prop("checked",function(){return!o(this).is(":hidden,:disabled")&&"select"===e})}),o(".imagify-check-group .imagify-row-check").on("change.imagify",function(){var i=o(this).closest(".imagify-check-group"),e=i.find(".imagify-row-check"),t=e.filter(":visible:enabled").length,a=e.filter(":visible:enabled:checked").length,e=i.next(".imagify-select-all-buttons"),i="imagify-is-inactive";0===a&&e.find('[data-action="unselect"]').addClass(i).attr("aria-disabled","true"),a===t&&e.find('[data-action="select"]').addClass(i).attr("aria-disabled","true"),a!==t&&0<a&&e.find(".imagify-select-all").removeClass(i).attr("aria-disabled","false")})}((window,document,jQuery));
window.imagify=window.imagify||{},function(e,s){var l=e.propHooks.checked;e.propHooks.checked={set:function(i,a,t){a=s===l?i[t]=a:l(i,a,t);return e(i).trigger("change.imagify"),a}},e.fn.imagifyHide=function(i,a){return i&&0<i?this.hide(i,function(){e(this).addClass("hidden").css("display",""),s!==a&&a()}):(this.addClass("hidden"),s!==a&&a()),this.attr("aria-hidden","true")},e.fn.imagifyShow=function(i,a){return s!==a&&a(),i&&0<i?this.show(i,function(){e(this).removeClass("hidden").css("display","")}):this.removeClass("hidden"),this.attr("aria-hidden","false")}}(jQuery),function(l,a,o,e){o.imagify.bulk={charts:{overview:{canvas:!1,donut:!1,data:{labels:[imagifyBulk.labels.overviewChartLabels.unoptimized,imagifyBulk.labels.overviewChartLabels.optimized,imagifyBulk.labels.overviewChartLabels.error],datasets:[{data:[],backgroundColor:["#10121A","#46B1CE","#C51162"],borderWidth:0}]}},files:{donuts:{}},share:{canvas:!1,donut:!1}},folderTypesQueue:[],status:{},displayedWaitMessage:!1,hasMultipleRows:!0,processIsStopped:!1,globalGain:0,globalOriginalSize:0,globalOptimizedSize:0,folderTypesData:{},init:function(){var i=l(a);this.drawOverviewChart(),this.hasMultipleRows=1<l('.imagify-bulk-table [name="group[]"]').length,l(".imagify-selector-button").on("click.imagify",this.openSelectorFromButton),l(".imagify-selector-list input").on("change.imagify init.imagify",this.syncSelectorFromRadio).filter(":checked").trigger("init.imagify"),i.on("keypress.imagify click.imagify",this.closeSelectors),l('.imagify-bulk-table [name="group[]"]').on("change.imagify init.imagify",this.toggleOptimizationButton).trigger("init.imagify"),l("#imagify-bulk-action").on("click.imagify",this.maybeLaunchAllProcesses),l(o).on("processQueue.imagify",this.processQueue).on("queueEmpty.imagify",this.queueEmpty),imagifyBulk.ajaxActions.getStats&&l('.imagify-bulk-table [data-group-id="library"][data-context="wp"]').length&&(imagifyBulk.imagifybeatIDs.stats=!1),imagifyBulk.imagifybeatIDs.stats&&i.on("imagifybeat-send",this.addStatsImagifybeat).on("imagifybeat-tick",this.processStatsImagifybeat),i.on("imagifybeat-send",this.addQueueImagifybeat).on("imagifybeat-tick",this.processQueueImagifybeat),i.on("imagifybeat-send",this.addRequirementsImagifybeat).on("imagifybeat-tick",this.processRequirementsImagifybeat),imagifyBulk.optimizing&&(o.imagify.beat.interval(15),o.imagify.beat.disableSuspend())},getAjaxUrl:function(i,a){i=ajaxurl+o.imagify.concat+"_wpnonce="+imagifyBulk.ajaxNonce+"&action="+imagifyBulk.ajaxActions[i];return a&&a.context&&(i+="&context="+a.context),a&&a.level&&(i+="&optimization_level="+a.level),i},getFolderTypes:function(){return l.isEmptyObject(o.imagify.bulk.folderTypesData)&&l(".imagify-row-folder-type").each(function(){var i=l(this),i={groupID:i.data("group-id"),context:i.data("context"),level:i.find('.imagify-cell-level [name="level['+i.data("group-id")+']"]:checked').val()};o.imagify.bulk.folderTypesData[i.groupID+"|"+i.context]=i}),o.imagify.bulk.folderTypesData},getConfirmMessage:function(){return imagifyBulk.labels.processing},closeLevelSelector:function(i,a){i&&i.length&&(e!==a&&0<a?o.setTimeout(function(){o.imagify.bulk.closeLevelSelector(i)},a):i.attr("aria-hidden","true"))},stopProcess:function(i,a){o.imagify.bulk.processIsStopped=!0,o.imagify.bulk.status[a.groupID]={isError:!0,id:i},l(o).trigger("queueEmpty.imagify")},hasBlockingError:function(i){return i=e!==i&&i,imagifyBulk.curlMissing?(i&&o.imagify.bulk.displayError({html:imagifyBulk.labels.curlMissing}),o.imagify.bulk.processIsStopped=!0):imagifyBulk.editorMissing?(i&&o.imagify.bulk.displayError({html:imagifyBulk.labels.editorMissing}),o.imagify.bulk.processIsStopped=!0):imagifyBulk.extHttpBlocked?(i&&o.imagify.bulk.displayError({html:imagifyBulk.labels.extHttpBlocked}),o.imagify.bulk.processIsStopped=!0):imagifyBulk.apiDown?(i&&o.imagify.bulk.displayError({html:imagifyBulk.labels.apiDown}),o.imagify.bulk.processIsStopped=!0):imagifyBulk.keyIsValid?!!imagifyBulk.isOverQuota&&(i&&o.imagify.bulk.displayError({title:imagifyBulk.labels.overQuotaTitle,html:l("#tmpl-imagify-overquota-alert").html(),type:"info",customClass:"imagify-swal-has-subtitle imagify-swal-error-header",showConfirmButton:!1}),o.imagify.bulk.processIsStopped=!0):(i&&o.imagify.bulk.displayError({title:imagifyBulk.labels.invalidAPIKeyTitle,type:"info"}),o.imagify.bulk.processIsStopped=!0)},displayError:function(i,a,t){var e={title:"",html:"",type:"error",customClass:"",width:620,padding:0,showCloseButton:!0,showConfirmButton:!0};(t=l.isPlainObject(i)?l.extend({},e,i):l.extend({},e,{title:i||"",html:a||""},t=t||{})).title=t.title||imagifyBulk.labels.error,t.customClass+=" imagify-sweet-alert",swal(t).catch(swal.noop)},displayShareBox:function(){var i;this.globalGain&&!this.folderTypesQueue.length&&((i=l(".imagify-row-complete")).find(".imagify-ac-rt-total-gain").html(this.globalOptimizedSize),i.find(".imagify-ac-rt-total-original").html(this.globalOriginalSize),i.find(".imagify-ac-chart").attr("data-percent",this.globalGain),this.drawShareChart(),i.addClass("done").imagifyShow(),l("html, body").animate({scrollTop:i.offset().top},200)),this.globalGain=0,this.globalOriginalSize=0,this.globalOptimizedSize=0},updateStats:function(i){var a;i&&l.isPlainObject(i)&&(o.imagify.bulk.charts.overview.donut.data&&(a=o.imagify.bulk.charts.overview.donut.data.datasets[0].data,i.unoptimized_attachments===a[0])&&i.optimized_attachments===a[1]&&i.errors_attachments===a[2]||(i.unconsumed_quota=i.unconsumed_quota.toFixed(1),l(".imagify-meteo-icon").html(i.quota_icon),l(".imagify-unconsumed-percent").html(i.unconsumed_quota+"%"),l(".imagify-unconsumed-bar").css("width",i.unconsumed_quota+"%").parent().attr("class",i.quota_class),l("#imagify-overview-chart-percent").html(i.optimized_attachments_percent+"<span>%</span>"),l(".imagify-total-percent").html(i.optimized_attachments_percent+"%"),o.imagify.bulk.drawOverviewChart([i.unoptimized_attachments,i.optimized_attachments,i.errors_attachments]),o.imagify.bulk.globalGain=i.optimized_percent,o.imagify.bulk.globalOriginalSize=i.original_human,o.imagify.bulk.globalOptimizedSize=i.optimized_human,l("#imagify-total-optimized-attachments").html(i.already_optimized_attachments),l("#imagify-original-bar").find(".imagify-barnb").html(i.original_human),l("#imagify-optimized-bar").css("width",100-i.optimized_percent+"%").find(".imagify-barnb").html(i.optimized_human),l("#imagify-total-optimized-attachments-pct").html(i.optimized_percent+"%")))},openSelectorFromButton:function(i){var a=l("#"+l(this).attr("aria-controls"));i.stopPropagation(),l(".imagify-selector-list").not(a).attr("aria-hidden","true"),a.attr("aria-hidden","false").find(":checked").trigger("focus.imagify")},syncSelectorFromRadio:function(){var i=l(this).closest(".imagify-selector-choice");i.addClass("imagify-selector-current-value").attr("aria-current","true").siblings(".imagify-selector-choice").removeClass("imagify-selector-current-value").attr("aria-current","false"),i.closest(".imagify-selector-list").siblings(".imagify-selector-button").find(".imagify-selector-current-value-info").html(i.find("label").html())},closeSelectors:function(i){"keypress"===i.type&&27!==i.keyCode&&13!==i.keyCode||o.imagify.bulk.closeLevelSelector(l('.imagify-selector-list[aria-hidden="false"]'))},toggleOptimizationButton:function(){o.imagify.bulk.hasMultipleRows||this.checked?imagifyBulk.optimizing||(l('.imagify-bulk-table [name="group[]"]:checked').length?l("#imagify-bulk-action").prop("disabled",!1):l("#imagify-bulk-action").prop("disabled",!0)):l(this).prop("checked",!0)},maybeLaunchAllProcesses:function(){var a;l(this).prop("disabled")||!l('.imagify-bulk-table [name="group[]"]:checked').length||o.imagify.bulk.hasBlockingError(!0)||((a=l("#tmpl-imagify-bulk-infos")).length?swal({title:imagifyBulk.labels.bulkInfoTitle,html:a.html(),type:"",customClass:"imagify-sweet-alert imagify-swal-has-subtitle imagify-before-bulk-infos",showCancelButton:!0,padding:0,width:554,confirmButtonText:imagifyBulk.labels.confirmBulk,cancelButtonText:imagifySwal.labels.cancelButtonText,reverseButtons:!0}).then(function(){var i=l('.imagify-bulk-table [name="group[]"]:checked').first().closest(".imagify-row-folder-type");l.get(o.imagify.bulk.getAjaxUrl("bulkInfoSeen",{context:i.data("context")})),a.remove(),o.imagify.bulk.launchAllProcesses()}).catch(swal.noop):o.imagify.bulk.launchAllProcesses())},launchAllProcesses:function(){var i=l(o);l("#imagify-bulk-action").prop("disabled",!0).find(".dashicons").addClass("rotate"),l(".imagify-row-complete").imagifyHide(200,function(){l(this).removeClass("done")}),this.folderTypesQueue=[],this.status={},this.displayedWaitMessage=!1,this.processIsStopped=!1,this.globalGain=0,this.globalOriginalSize=0,this.globalOptimizedSize=0,l('.imagify-bulk-table [name="group[]"]:checked').each(function(){var i=l(this).closest(".imagify-row-folder-type"),a=i.data("group-id"),t=i.data("context"),i=i.find('.imagify-cell-level [name="level['+a+']"]:checked').val();o.imagify.bulk.folderTypesQueue.push({groupID:a,context:t,level:e===i?-1:parseInt(i,10)}),o.imagify.bulk.status[a]={isError:!1,id:"waiting"}}),o.imagify.beat.interval(15),o.imagify.beat.disableSuspend(),i.trigger("processQueue.imagify")},processQueue:function(){var e;o.imagify.bulk.processIsStopped||(o.imagify.bulk.displayedWaitMessage||(swal({title:imagifyBulk.labels.waitTitle,html:imagifyBulk.labels.waitText,showConfirmButton:!1,padding:0,imageUrl:imagifyBulk.waitImageUrl,customClass:"imagify-sweet-alert"}).catch(swal.noop),o.imagify.bulk.displayedWaitMessage=!0),o.imagify.bulk.folderTypesQueue.forEach(function(t){o.imagify.bulk.status[t.groupID].id="fetching",l.get(o.imagify.bulk.getAjaxUrl("bulkProcess",t)).done(function(i){var a;swal.close(),a=i.data&&i.data.message?i.data.message:imagifyBulk.ajaxErrorText,i.success&&i.data&&(l.isPlainObject(i.data)||l.isArray(i.data))?i.success&&(o.imagify.bulk.status[t.groupID].id="optimizing",e=l("#cb-select-"+t.groupID).closest(".imagify-row-folder-type"),e=e.closest(".imagify-bulk-table"),e=e.find(".imagify-row-progress"),e.find(".bar").css("width","0%").find(".percent").text("0%"),e.slideDown().attr("aria-hidden","false")):o.imagify.bulk.stopProcess(a,t)}).fail(function(){o.imagify.bulk.stopProcess("get-unoptimized-images",t)})}))},queueEmpty:function(){var i=l(".imagify-bulk-table"),a={},t=!1,e=!0,s="";o.imagify.beat.resetInterval(),o.imagify.beat.enableSuspend(),o.imagify.bulk.folderTypesQueue=[],o.imagify.bulk.displayShareBox(),imagifyBulk.imagifybeatIDs.stats||l.get(o.imagify.bulk.getAjaxUrl("getStats"),{types:o.imagify.bulk.getFolderTypes()}).done(function(i){i.success&&o.imagify.bulk.updateStats(i.data)}),l.isEmptyObject(o.imagify.bulk.status)||(l.each(o.imagify.bulk.status,function(i,a){if(a.isError){if("no-images"!==a.id&&a.isError)return t=a.id,e=!1}else e=!1}),t?("invalid-api-key"===t?a={title:imagifyBulk.labels.invalidAPIKeyTitle,type:"info"}:"over-quota"===t?a={title:imagifyBulk.labels.overQuotaTitle,html:l("#tmpl-imagify-overquota-alert").html(),type:"info",customClass:"imagify-swal-has-subtitle imagify-swal-error-header",showConfirmButton:!1}:"get-unoptimized-images"!==t&&"consumed-all-data"!==t||(a={title:imagifyBulk.labels.getUnoptimizedImagesErrorTitle,html:imagifyBulk.labels.getUnoptimizedImagesErrorText,type:"info"}),o.imagify.bulk.displayError(a)):e&&(s=Object.prototype.hasOwnProperty.call(imagifyBulk.labels.nothingToDoText,o.imagify.bulk.imagifyAction)?imagifyBulk.labels.nothingToDoText[o.imagify.bulk.imagifyAction]:imagifyBulk.labels.nothingToDoText.optimize,o.imagify.bulk.displayError({title:imagifyBulk.labels.nothingToDoTitle,html:s,type:"info"}))),o.imagify.bulk.status={},i.find(".imagify-row-progress").slideUp().attr("aria-hidden","true").find(".bar").removeAttr("style").find(".percent").text("0%"),(l('.imagify-bulk-table [name="group[]"]:checked').length?l("#imagify-bulk-action").prop("disabled",!1):l("#imagify-bulk-action")).find(".dashicons").removeClass("rotate")},addStatsImagifybeat:function(i,a){a[imagifyBulk.imagifybeatIDs.stats]=Object.keys(o.imagify.bulk.getFolderTypes())},processStatsImagifybeat:function(i,a){void 0!==a[imagifyBulk.imagifybeatIDs.stats]&&o.imagify.bulk.updateStats(a[imagifyBulk.imagifybeatIDs.stats])},addQueueImagifybeat:function(i,a){a[imagifyBulk.imagifybeatIDs.queue]=Object.values(o.imagify.bulk.getFolderTypes())},processQueueImagifybeat:function(i,a){var t,e;void 0!==a[imagifyBulk.imagifybeatIDs.queue]&&(100===(a=a[imagifyBulk.imagifybeatIDs.queue]).percentage||!o.imagify.bulk.processIsStopped&&o.imagify.bulk.hasBlockingError(!0)?l(o).trigger("queueEmpty.imagify"):(Object.prototype.hasOwnProperty.call(a,"groups_data")&&Object.entries(a.groups_data).forEach(function(i){(t=l("[data-context="+i[0]+"]")).children(".imagify-cell-count-optimized").first().html(i[1]["count-optimized"]),t.children(".imagify-cell-count-errors").first().html(i[1]["count-errors"]),t.children(".imagify-cell-optimized-size-size").first().html(i[1]["optimized-size"]),t.children(".imagify-cell-original-size-size").first().html(i[1]["original-size"])}),(e=l(".imagify-row-progress")).find(".bar").css("width",a.percentage+"%").find(".percent").html(a.percentage+"%"),e.slideDown().attr("aria-hidden","false")))},addRequirementsImagifybeat:function(i,a){a[imagifyBulk.imagifybeatIDs.requirements]=1},processRequirementsImagifybeat:function(i,a){void 0!==a[imagifyBulk.imagifybeatIDs.requirements]&&(a=a[imagifyBulk.imagifybeatIDs.requirements],imagifyBulk.curlMissing=a.curl_missing,imagifyBulk.editorMissing=a.editor_missing,imagifyBulk.extHttpBlocked=a.external_http_blocked,imagifyBulk.apiDown=a.api_down,imagifyBulk.keyIsValid=a.key_is_valid,imagifyBulk.isOverQuota=a.is_over_quota)},drawOverviewChart:function(i){var t,e;(this.charts.overview.canvas||(this.charts.overview.canvas=a.getElementById("imagify-overview-chart"),this.charts.overview.canvas))&&(i=i&&l.isArray(i)?i:[],this.charts.overview.donut?i.length&&(0===i.reduce(function(i,a){return i+a},0)&&(i[0]=1),this.charts.overview.donut.data.datasets[0].data=i,this.charts.overview.donut.update()):(this.charts.overview.data.datasets[0].data=[parseInt(this.charts.overview.canvas.getAttribute("data-unoptimized"),10),parseInt(this.charts.overview.canvas.getAttribute("data-optimized"),10),parseInt(this.charts.overview.canvas.getAttribute("data-errors"),10)],t=l.extend({},this.charts.overview.data),i.length&&(t.datasets[0].data=i),0===t.datasets[0].data.reduce(function(i,a){return i+a},0)&&(t.datasets[0].data[0]=1),this.charts.overview.donut=new o.imagify.Chart(this.charts.overview.canvas,{type:"doughnut",data:t,options:{legend:{display:!1},events:[],animation:{easing:"easeOutBounce"},tooltips:{displayColors:!1,callbacks:{label:function(i,a){return a.datasets[i.datasetIndex].data[i.index]}}},responsive:!1,cutoutPercentage:85}}),e='<ul class="imagify-doughnut-legend">',l.each(t.labels,function(i,a){e+='<li><span style="background-color:'+t.datasets[0].backgroundColor[i]+'"></span>'+a+"</li>"}),e+="</ul>",a.getElementById("imagify-overview-chart-legend").innerHTML=e))},drawShareChart:function(){var i;(this.charts.share.canvas||(this.charts.share.canvas=a.getElementById("imagify-ac-chart"),this.charts.share.canvas))&&(i=parseInt(l(this.charts.share.canvas).closest(".imagify-ac-chart").attr("data-percent"),10),this.charts.share.donut?(this.charts.share.donut.data.datasets[0].data[0]=i,this.charts.share.donut.data.datasets[0].data[1]=100-i,this.charts.share.donut.update()):this.charts.share.donut=new o.imagify.Chart(this.charts.share.canvas,{type:"doughnut",data:{datasets:[{data:[i,100-i],backgroundColor:["#40B1D0","#FFFFFF"],borderWidth:0}]},options:{legend:{display:!1},events:[],animation:{easing:"easeOutBounce"},tooltips:{enabled:!1},responsive:!1,cutoutPercentage:70}}))}},o.imagify.bulk.init()}(jQuery,document,window);
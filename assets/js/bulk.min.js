window.imagify=window.imagify||{},function(t,s){var l=t.propHooks.checked;t.propHooks.checked={set:function(i,a,e){a=s===l?i[e]=a:l(i,a,e);return t(i).trigger("change.imagify"),a}},t.fn.imagifyHide=function(i,a){return i&&0<i?this.hide(i,function(){t(this).addClass("hidden").css("display",""),s!==a&&a()}):(this.addClass("hidden"),s!==a&&a()),this.attr("aria-hidden","true")},t.fn.imagifyShow=function(i,a){return s!==a&&a(),i&&0<i?this.show(i,function(){t(this).removeClass("hidden").css("display","")}):this.removeClass("hidden"),this.attr("aria-hidden","false")}}(jQuery),function(o,a,r,t){r.imagify.bulk={charts:{overview:{canvas:!1,donut:!1,data:{labels:[imagifyBulk.labels.overviewChartLabels.unoptimized,imagifyBulk.labels.overviewChartLabels.optimized,imagifyBulk.labels.overviewChartLabels.error],datasets:[{data:[],backgroundColor:["#10121A","#46B1CE","#C51162"],borderWidth:0}]}},files:{donuts:{}},share:{canvas:!1,donut:!1}},folderTypesQueue:[],status:{},displayedWaitMessage:!1,hasMultipleRows:!0,processIsStopped:!1,globalOptimizedCount:0,globalGain:0,globalOriginalSize:0,globalOptimizedSize:0,folderTypesData:{},init:function(){var i=o(a);this.drawOverviewChart(),this.hasMultipleRows=1<o('.imagify-bulk-table [name="group[]"]').length,o(".imagify-selector-button").on("click.imagify",this.openSelectorFromButton),o(".imagify-selector-list input").on("change.imagify init.imagify",this.syncSelectorFromRadio).filter(":checked").trigger("init.imagify"),i.on("keypress.imagify click.imagify",this.closeSelectors),o('.imagify-bulk-table [name="group[]"]').on("change.imagify init.imagify",this.toggleOptimizationButton).trigger("init.imagify"),o("#imagify-bulk-action").on("click.imagify",this.maybeLaunchAllProcesses),o(r).on("processQueue.imagify",this.processQueue).on("queueEmpty.imagify",this.queueEmpty),imagifyBulk.ajaxActions.getStats&&o('.imagify-bulk-table [data-group-id="library"][data-context="wp"]').length&&(imagifyBulk.imagifybeatIDs.stats=!1),imagifyBulk.imagifybeatIDs.stats&&i.on("imagifybeat-send",this.addStatsImagifybeat).on("imagifybeat-tick",this.processStatsImagifybeat),i.on("imagifybeat-send",this.addQueueImagifybeat).on("imagifybeat-tick",this.processQueueImagifybeat),i.on("imagifybeat-send",this.addRequirementsImagifybeat).on("imagifybeat-tick",this.processRequirementsImagifybeat),imagifyBulk.optimizing&&(r.imagify.beat.interval(15),r.imagify.beat.disableSuspend())},getAjaxUrl:function(i,a){i=ajaxurl+r.imagify.concat+"_wpnonce="+imagifyBulk.ajaxNonce+"&action="+imagifyBulk.ajaxActions[i];return a&&a.context&&(i+="&context="+a.context),a&&Number.isInteger(a.level)&&(i+="&optimization_level="+a.level),i},getFolderTypes:function(){return o.isEmptyObject(r.imagify.bulk.folderTypesData)&&o(".imagify-row-folder-type").each(function(){var i=o(this),i={groupID:i.data("group-id"),context:i.data("context"),level:i.find('.imagify-cell-level [name="level['+i.data("group-id")+']"]:checked').val()};r.imagify.bulk.folderTypesData[i.groupID+"|"+i.context]=i}),r.imagify.bulk.folderTypesData},getConfirmMessage:function(){return imagifyBulk.labels.processing},closeLevelSelector:function(i,a){i&&i.length&&(t!==a&&0<a?r.setTimeout(function(){r.imagify.bulk.closeLevelSelector(i)},a):i.attr("aria-hidden","true"))},stopProcess:function(i,a){r.imagify.bulk.processIsStopped=!0,r.imagify.bulk.status[a.groupID]={isError:!0,id:i},o(r).trigger("queueEmpty.imagify")},hasBlockingError:function(i){return i=t!==i&&i,imagifyBulk.curlMissing?(i&&r.imagify.bulk.displayError({html:imagifyBulk.labels.curlMissing}),r.imagify.bulk.processIsStopped=!0):imagifyBulk.editorMissing?(i&&r.imagify.bulk.displayError({html:imagifyBulk.labels.editorMissing}),r.imagify.bulk.processIsStopped=!0):imagifyBulk.extHttpBlocked?(i&&r.imagify.bulk.displayError({html:imagifyBulk.labels.extHttpBlocked}),r.imagify.bulk.processIsStopped=!0):imagifyBulk.apiDown?(i&&r.imagify.bulk.displayError({html:imagifyBulk.labels.apiDown}),r.imagify.bulk.processIsStopped=!0):imagifyBulk.keyIsValid?!!imagifyBulk.isOverQuota&&(i&&r.imagify.bulk.displayError({title:imagifyBulk.labels.overQuotaTitle,html:o("#tmpl-imagify-overquota-alert").html(),type:"info",customClass:"imagify-swal-has-subtitle imagify-swal-error-header",showConfirmButton:!1}),r.imagify.bulk.processIsStopped=!0):(i&&r.imagify.bulk.displayError({title:imagifyBulk.labels.invalidAPIKeyTitle,type:"info"}),r.imagify.bulk.processIsStopped=!0)},displayError:function(i,a,e){var t={title:"",html:"",type:"error",customClass:"",width:620,padding:0,showCloseButton:!0,showConfirmButton:!0};(e=o.isPlainObject(i)?o.extend({},t,i):o.extend({},t,{title:i||"",html:a||""},e=e||{})).title=e.title||imagifyBulk.labels.error,e.customClass+=" imagify-sweet-alert",swal(e).catch(swal.noop)},displayShareBox:function(){var i,a;this.globalGain&&!this.folderTypesQueue.length&&(a=this.globalOriginalSize-this.globalOptimizedSize,(i=o(".imagify-row-complete")).find(".imagify-ac-rt-total-images").html(this.globalOptimizedCount),i.find(".imagify-ac-rt-total-gain").html(r.imagify.humanSize(a,1)),i.find(".imagify-ac-rt-total-original").html(r.imagify.humanSize(this.globalOriginalSize,1)),i.find(".imagify-ac-chart").attr("data-percent",Math.round(this.globalGain)),this.drawShareChart(),i.addClass("done").imagifyShow(),o("html, body").animate({scrollTop:i.offset().top},200)),this.globalOptimizedCount=0,this.globalGain=0,this.globalOriginalSize=0,this.globalOptimizedSize=0},updateStats:function(i){var a;i&&o.isPlainObject(i)&&(r.imagify.bulk.charts.overview.donut.data&&(a=r.imagify.bulk.charts.overview.donut.data.datasets[0].data,i.unoptimized_attachments===a[0])&&i.optimized_attachments===a[1]&&i.errors_attachments===a[2]||(i.unconsumed_quota=i.unconsumed_quota.toFixed(1),o(".imagify-meteo-icon").html(i.quota_icon),o(".imagify-unconsumed-percent").html(i.unconsumed_quota+"%"),o(".imagify-unconsumed-bar").css("width",i.unconsumed_quota+"%").parent().attr("class",i.quota_class),o("#imagify-overview-chart-percent").html(i.optimized_attachments_percent+"<span>%</span>"),o(".imagify-total-percent").html(i.optimized_attachments_percent+"%"),r.imagify.bulk.drawOverviewChart([i.unoptimized_attachments,i.optimized_attachments,i.errors_attachments]),o("#imagify-total-optimized-attachments").html(i.already_optimized_attachments),o("#imagify-original-bar").find(".imagify-barnb").html(i.original_human),o("#imagify-optimized-bar").css("width",100-i.optimized_percent+"%").find(".imagify-barnb").html(i.optimized_human),o("#imagify-total-optimized-attachments-pct").html(i.optimized_percent+"%")))},openSelectorFromButton:function(i){var a=o("#"+o(this).attr("aria-controls"));i.stopPropagation(),o(".imagify-selector-list").not(a).attr("aria-hidden","true"),a.attr("aria-hidden","false").find(":checked").trigger("focus.imagify")},syncSelectorFromRadio:function(){var i=o(this).closest(".imagify-selector-choice");i.addClass("imagify-selector-current-value").attr("aria-current","true").siblings(".imagify-selector-choice").removeClass("imagify-selector-current-value").attr("aria-current","false"),i.closest(".imagify-selector-list").siblings(".imagify-selector-button").find(".imagify-selector-current-value-info").html(i.find("label").html())},closeSelectors:function(i){"keypress"===i.type&&27!==i.keyCode&&13!==i.keyCode||r.imagify.bulk.closeLevelSelector(o('.imagify-selector-list[aria-hidden="false"]'))},toggleOptimizationButton:function(){r.imagify.bulk.hasMultipleRows||this.checked?!imagifyBulk.optimizing&&o('.imagify-bulk-table [name="group[]"]:checked').length?o("#imagify-bulk-action").prop("disabled",!1):o("#imagify-bulk-action").prop("disabled",!0):o(this).prop("checked",!0)},maybeLaunchAllProcesses:function(){var a;o(this).prop("disabled")||!o('.imagify-bulk-table [name="group[]"]:checked').length||r.imagify.bulk.hasBlockingError(!0)||((a=o("#tmpl-imagify-bulk-infos")).length?swal({title:imagifyBulk.labels.bulkInfoTitle,html:a.html(),type:"",customClass:"imagify-sweet-alert imagify-swal-has-subtitle imagify-before-bulk-infos",showCancelButton:!0,padding:0,width:554,confirmButtonText:imagifyBulk.labels.confirmBulk,cancelButtonText:imagifySwal.labels.cancelButtonText,reverseButtons:!0}).then(function(){var i=o('.imagify-bulk-table [name="group[]"]:checked').first().closest(".imagify-row-folder-type");o.get(r.imagify.bulk.getAjaxUrl("bulkInfoSeen",{context:i.data("context")})),a.remove(),r.imagify.bulk.launchAllProcesses()}).catch(swal.noop):r.imagify.bulk.launchAllProcesses())},launchAllProcesses:function(){var i=o(r);o("#imagify-bulk-action").prop("disabled",!0).find(".dashicons").addClass("rotate"),o(".imagify-row-complete").imagifyHide(200,function(){o(this).removeClass("done")}),this.folderTypesQueue=[],this.status={},this.displayedWaitMessage=!1,this.processIsStopped=!1,this.globalOptimizedCount=0,this.globalGain=0,this.globalOriginalSize=0,this.globalOptimizedSize=0,o('.imagify-bulk-table [name="group[]"]:checked').each(function(){var i=o(this).closest(".imagify-row-folder-type"),a=i.data("group-id"),e=i.data("context"),i=i.find('.imagify-cell-level [name="level['+a+']"]:checked').val();r.imagify.bulk.folderTypesQueue.push({groupID:a,context:e,level:t===i?-1:parseInt(i,10)}),r.imagify.bulk.status[a]={isError:!1,id:"waiting"}}),r.imagify.beat.interval(15),r.imagify.beat.disableSuspend(),i.trigger("processQueue.imagify")},processQueue:function(){var t,s,l;r.imagify.bulk.processIsStopped||(r.imagify.bulk.displayedWaitMessage||(swal({title:imagifyBulk.labels.waitTitle,html:imagifyBulk.labels.waitText,showConfirmButton:!1,padding:0,imageUrl:imagifyBulk.waitImageUrl,customClass:"imagify-sweet-alert"}).catch(swal.noop),r.imagify.bulk.displayedWaitMessage=!0),r.imagify.bulk.folderTypesQueue.forEach(function(e){o.get(r.imagify.bulk.getAjaxUrl("bulkProcess",e)).done(function(i){var a;swal.close(),a=i.data&&i.data.message?i.data.message:imagifyBulk.ajaxErrorText,i.success&&i.data&&(o.isPlainObject(i.data)||o.isArray(i.data))?i.success&&(t=o("#cb-select-"+e.groupID).closest(".imagify-row-folder-type"),s=t.closest(".imagify-bulk-table"),s=s.find(".imagify-row-progress"),l=s.find(".bar"),t.find(".imagify-cell-checkbox-loader").removeClass("hidden").attr("aria-hidden","false"),t.find(".imagify-cell-checkbox-box").addClass("hidden").attr("aria-hidden","true"),l.css("width","0%").find(".percent").text("0%"),s.slideDown().attr("aria-hidden","false")):r.imagify.bulk.stopProcess(a,e)}).fail(function(){r.imagify.bulk.stopProcess("get-unoptimized-images",e)})}))},queueEmpty:function(){var i=o(".imagify-bulk-table"),a={},e=!1,t=!0,s="";r.imagify.beat.resetInterval(),r.imagify.beat.enableSuspend(),r.imagify.bulk.folderTypesQueue=[],r.imagify.bulk.displayShareBox(),imagifyBulk.imagifybeatIDs.stats||o.get(r.imagify.bulk.getAjaxUrl("getStats"),{types:r.imagify.bulk.getFolderTypes()}).done(function(i){i.success&&r.imagify.bulk.updateStats(i.data)}),o.isEmptyObject(r.imagify.bulk.status)||(o.each(r.imagify.bulk.status,function(i,a){if(a.isError){if("no-images"!==a.id&&a.isError)return e=a.id,t=!1}else t=!1}),e?("invalid-api-key"===e?a={title:imagifyBulk.labels.invalidAPIKeyTitle,type:"info"}:"over-quota"===e?a={title:imagifyBulk.labels.overQuotaTitle,html:o("#tmpl-imagify-overquota-alert").html(),type:"info",customClass:"imagify-swal-has-subtitle imagify-swal-error-header",showConfirmButton:!1}:"get-unoptimized-images"!==e&&"consumed-all-data"!==e||(a={title:imagifyBulk.labels.getUnoptimizedImagesErrorTitle,html:imagifyBulk.labels.getUnoptimizedImagesErrorText,type:"info"}),r.imagify.bulk.displayError(a)):t&&(s=Object.prototype.hasOwnProperty.call(imagifyBulk.labels.nothingToDoText,r.imagify.bulk.imagifyAction)?imagifyBulk.labels.nothingToDoText[r.imagify.bulk.imagifyAction]:imagifyBulk.labels.nothingToDoText.optimize,r.imagify.bulk.displayError({title:imagifyBulk.labels.nothingToDoTitle,html:s,type:"info"}))),r.imagify.bulk.status={},i.find(".imagify-row-progress").slideUp().attr("aria-hidden","true").find(".bar").removeAttr("style").find(".percent").text("0%"),i.find(".imagify-cell-checkbox-loader").each(function(){o(this).addClass("hidden").attr("aria-hidden","true")}),i.find(".imagify-cell-checkbox-box").each(function(){o(this).removeClass("hidden").attr("aria-hidden","false")}),(o('.imagify-bulk-table [name="group[]"]:checked').length?o("#imagify-bulk-action").prop("disabled",!1):o("#imagify-bulk-action")).find(".dashicons").removeClass("rotate")},addStatsImagifybeat:function(i,a){a[imagifyBulk.imagifybeatIDs.stats]=Object.keys(r.imagify.bulk.getFolderTypes())},processStatsImagifybeat:function(i,a){void 0!==a[imagifyBulk.imagifybeatIDs.stats]&&r.imagify.bulk.updateStats(a[imagifyBulk.imagifybeatIDs.stats])},addQueueImagifybeat:function(i,a){a[imagifyBulk.imagifybeatIDs.queue]=Object.values(r.imagify.bulk.getFolderTypes())},processQueueImagifybeat:function(i,a){var e,t;void 0!==a[imagifyBulk.imagifybeatIDs.queue]&&(!1!==(a=a[imagifyBulk.imagifybeatIDs.queue]).result&&(r.imagify.bulk.globalOriginalSize=a.result.original_size,r.imagify.bulk.globalOptimizedSize=a.result.optimized_size,r.imagify.bulk.globalOptimizedCount=a.result.total,r.imagify.bulk.globalGain=100*r.imagify.bulk.globalOptimizedSize/r.imagify.bulk.globalOriginalSize),!r.imagify.bulk.processIsStopped&&r.imagify.bulk.hasBlockingError(!0)||(Object.prototype.hasOwnProperty.call(a,"groups_data")&&Object.entries(a.groups_data).forEach(function(i){(e=o("[data-context="+i[0]+"]")).children(".imagify-cell-count-optimized").first().html(i[1]["count-optimized"]),e.children(".imagify-cell-count-errors").first().html(i[1]["count-errors"]),e.children(".imagify-cell-optimized-size-size").first().html(i[1]["optimized-size"]),e.children(".imagify-cell-original-size-size").first().html(i[1]["original-size"])}),0===a.remaining)?o(r).trigger("queueEmpty.imagify"):((t=o(".imagify-row-progress")).find(".bar").css("width",a.percentage+"%").find(".percent").html(a.percentage+"%"),t.slideDown().attr("aria-hidden","false")))},addRequirementsImagifybeat:function(i,a){a[imagifyBulk.imagifybeatIDs.requirements]=1},processRequirementsImagifybeat:function(i,a){void 0!==a[imagifyBulk.imagifybeatIDs.requirements]&&(a=a[imagifyBulk.imagifybeatIDs.requirements],imagifyBulk.curlMissing=a.curl_missing,imagifyBulk.editorMissing=a.editor_missing,imagifyBulk.extHttpBlocked=a.external_http_blocked,imagifyBulk.apiDown=a.api_down,imagifyBulk.keyIsValid=a.key_is_valid,imagifyBulk.isOverQuota=a.is_over_quota)},drawOverviewChart:function(i){var e,t;(this.charts.overview.canvas||(this.charts.overview.canvas=a.getElementById("imagify-overview-chart"),this.charts.overview.canvas))&&(i=i&&o.isArray(i)?i:[],this.charts.overview.donut?i.length&&(0===i.reduce(function(i,a){return i+a},0)&&(i[0]=1),this.charts.overview.donut.data.datasets[0].data=i,this.charts.overview.donut.update()):(this.charts.overview.data.datasets[0].data=[parseInt(this.charts.overview.canvas.getAttribute("data-unoptimized"),10),parseInt(this.charts.overview.canvas.getAttribute("data-optimized"),10),parseInt(this.charts.overview.canvas.getAttribute("data-errors"),10)],e=o.extend({},this.charts.overview.data),i.length&&(e.datasets[0].data=i),0===e.datasets[0].data.reduce(function(i,a){return i+a},0)&&(e.datasets[0].data[0]=1),this.charts.overview.donut=new r.imagify.Chart(this.charts.overview.canvas,{type:"doughnut",data:e,options:{legend:{display:!1},events:[],animation:{easing:"easeOutBounce"},tooltips:{displayColors:!1,callbacks:{label:function(i,a){return a.datasets[i.datasetIndex].data[i.index]}}},responsive:!1,cutoutPercentage:85}}),t='<ul class="imagify-doughnut-legend">',o.each(e.labels,function(i,a){t+='<li><span style="background-color:'+e.datasets[0].backgroundColor[i]+'"></span>'+a+"</li>"}),t+="</ul>",a.getElementById("imagify-overview-chart-legend").innerHTML=t))},drawShareChart:function(){var i;(this.charts.share.canvas||(this.charts.share.canvas=a.getElementById("imagify-ac-chart"),this.charts.share.canvas))&&(i=parseInt(o(this.charts.share.canvas).closest(".imagify-ac-chart").attr("data-percent"),10),this.charts.share.donut?(this.charts.share.donut.data.datasets[0].data[0]=i,this.charts.share.donut.data.datasets[0].data[1]=100-i,this.charts.share.donut.update()):this.charts.share.donut=new r.imagify.Chart(this.charts.share.canvas,{type:"doughnut",data:{datasets:[{data:[i,100-i],backgroundColor:["#40B1D0","#FFFFFF"],borderWidth:0}]},options:{legend:{display:!1},events:[],animation:{easing:"easeOutBounce"},tooltips:{enabled:!1},responsive:!1,cutoutPercentage:70}}))}},r.imagify.bulk.init()}(jQuery,document,window);